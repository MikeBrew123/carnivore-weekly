# Daily Log — 2026-01-14

## Session Goals
- Debug calculator report generation issues (portions, diet restrictions, allergies)
- Verify deployment pipeline working correctly
- Identify whether bugs are deployment or logic issues

## What Got Done
- ✅ Created /version endpoint to verify deployments
- ✅ Confirmed calculator-api.js is the active production file (not generate-report.js)
- ✅ Verified recent code fixes ARE deployed to production (v2025-01-14-2130-test)
- ✅ Proved deployment pipeline works correctly with --env production flag
- ✅ Created comprehensive status document (CALCULATOR-STATUS-2025-01-14.md)
- ✅ Identified bugs as logic issues, not deployment issues

## What Changed Today
**Files Modified:**
- api/calculator-api.js (added version endpoint, macro calculation logic, Keto diet detection)
- CALCULATOR-STATUS-2025-01-14.md (created comprehensive status document)

**Critical Discovery:**
- Production Worker URL: carnivore-report-api-production.iambrew.workers.dev
- Deploy command requires: wrangler deploy --env production
- All code changes from today are confirmed live in production
- Bugs persist despite fixes being deployed

## Decisions Made
**Decision: Stop making code changes without logging**
- Reason: 15 hours spent debugging, most fixes deployed but not executing correctly
- Next approach: Add console.log statements and use wrangler tail --env production
- Rationale: Need to see actual data reaching functions before making more assumptions

**Decision: Deployment pipeline is correct**
- Verification: /version endpoint proves recent code is live
- Lesson: Always verify deployment with a version endpoint before debugging

## Assumptions in Play
**INVALIDATED:** "Fixes aren't deploying" → Actually deployed, just not executing correctly
**NEW:** Bugs are logic errors in the deployed code, not deployment issues
**NEW:** Data may not be reaching functions as expected (needs logging to verify)

## Open Questions
- Why are portions still hardcoded at 200g despite personalization code being deployed?
- Why does Keto diet show carnivore-only meals when vegetable detection code exists?
- Why do egg allergies still appear despite exclusion code?
- What data is ACTUALLY reaching generateFullMealPlan() function?

## Issues/Blockers
**Bugs Still Present (Logic Issues):**
1. Portions hardcoded at 200g despite personalization code deployed
2. Keto diet shows carnivore-only meals (vegetables missing)
3. Egg allergies still appear in some sections
4. Logo prints on separate page

**Root Cause:**
Fixes are deployed but not executing. Either:
- Wrong code path being hit
- Data not reaching functions correctly
- Logic errors in the fixes themselves

**Impact:** Reports are personalized in some sections but not others

## Extracted Insights (Worth Remembering)
**Lesson: Always verify deployment before debugging**
- Time Lost: ~15 hours
- Root Cause: Deployed to wrong environment initially, then assumed fixes worked without verification
- Prevention: Always add /version endpoint or similar verification method
- Prevention: Use console.log + wrangler tail early in debugging process

**Lesson: Deployment success ≠ code working correctly**
- Just because code is deployed doesn't mean it's executing as expected
- Always verify with logging, not assumptions
- Real data inspection is faster than making more code changes

**Time Investment Breakdown:**
- ~15 hours total debugging
- Most time lost to:
  - Deploying to wrong environment initially
  - Assuming fixes worked without verification
  - Not using console.log + wrangler tail early enough

## Files Touched / Reviewed
**Modified:**
- /Users/mbrew/Developer/carnivore-weekly/api/calculator-api.js
- /Users/mbrew/Developer/carnivore-weekly/CALCULATOR-STATUS-2025-01-14.md

**Reviewed:**
- /Users/mbrew/Developer/carnivore-weekly/api/generate-report.js (confirmed not in use)
- Production deployment configuration

## Tomorrow's Priority
**DO NOT make more code changes. Start with logging:**
1. Add console.log at start of generateFullMealPlan() to see incoming data
2. Deploy with: cd api && wrangler deploy --env production
3. Run: wrangler tail --env production
4. Generate test report and observe actual data flow
5. Fix based on real data, not assumptions

**Critical:** Logging first, then fixes based on observed behavior.

---

## BLOCKER: Writer Agents Not Callable (RECURRING ISSUE)

### Context
User requested we have Sarah, Marcus, and Chloe each write one blog post and publish them. Per CLAUDE.md rules, we MUST use writer agents for all written content.

**CRITICAL HISTORICAL NOTE:** User stated "this is not the first time we tried to add them as agents" - indicating previous attempts to make writer agents callable have failed.

### Problem Description
Writer agents (sarah-health-coach, marcus-performance-coach, chloe-community-manager) are not callable via Task tool, despite proper configuration.

### What We Verified
1. **Agent files exist and are properly configured:**
   - `/Users/mbrew/Developer/carnivore-weekly/.claude/agents/sarah.md` (8.8KB)
   - `/Users/mbrew/Developer/carnivore-weekly/.claude/agents/marcus.md` (8.7KB)
   - `/Users/mbrew/Developer/carnivore-weekly/.claude/agents/chloe.md` (10.4KB)

2. **File structure matches working agents:**
   ```yaml
   ---
   name: sarah-health-coach
   description: Use this agent when you need...
   tools: Read, Write, Grep, Bash
   model: inherit
   ---
   ```

3. **Other agents work correctly:**
   - Leo (leo-database-architect) - callable
   - Quinn (quinn-operations-manager) - callable

4. **Writer agents do NOT appear in available agents list**
   - Despite identical configuration structure
   - Despite being in same directory as working agents

### Root Cause Analysis
**Unknown.** Possible theories:
- Agent registration limit in Claude Code?
- Different permissions needed for writer agents?
- Missing Claude Code configuration file?
- Bug in Claude Code agent discovery?
- Timing issue (agents added after session started)?

### Proposed Solution
**Option 1:** Restart Claude Code session to reload agent registry
- **Confidence:** LOW (given historical failures)
- **Risk:** If this fails again, confirms systemic issue

### Fallback Options If Restart Fails
1. **Use main session with writer personas** (similar to Leo MCP workaround)
   - Main session follows writer guidelines from agent files
   - Apply humanization and soft-conversion skills manually
   - Less ideal but workable

2. **Build custom skill-based system**
   - Replace agent calls with skill invocations
   - May require architecture changes

3. **Accept limitation**
   - Document that writer agents are not callable in this environment
   - Use main session for all content creation

### Next Steps
1. User will restart Claude Code session
2. Test if writers become callable after restart
3. If successful: Invoke writers to create blog posts
4. If unsuccessful: Choose fallback option and document as permanent limitation

### Questions for Future Investigation
- Why do Leo and Quinn work but writers don't?
- Is there a Claude Code agent registration mechanism we're missing?
- Do agent names/descriptions affect discoverability?
- Is there a debug mode to see why agents aren't loading?
- Should we check Claude Code logs/settings?

### Impact
**HIGH:** Cannot follow CLAUDE.md content quality rules without writer agents. All written content must be humanized and use soft-conversion techniques, which requires writer agent expertise.

**Status:** BLOCKED pending session restart verification.

---
