<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Free carnivore diet macro calculator. Get personalized calories, protein, and fat targets with meal examples and electrolyte guidance. No email required.">
    <meta name="keywords" content="carnivore calculator, macro calculator, carnivore diet macros, keto calculator, protein calculator, free diet calculator">
    <meta name="author" content="Carnivore Weekly">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://carnivoreweekly.com/calculator.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://carnivoreweekly.com/calculator.html">
    <meta property="og:title" content="Free Carnivore Macro Calculator | Carnivore Weekly">
    <meta property="og:description" content="Calculate your personalized carnivore macros. Free, private, no email required. Includes meal examples and electrolyte guidance.">
    <meta property="og:image" content="https://carnivoreweekly.com/images/logo.png">
    <meta property="og:site_name" content="Carnivore Weekly">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://carnivoreweekly.com/calculator.html">
    <meta name="twitter:title" content="Free Carnivore Macro Calculator | Carnivore Weekly">
    <meta name="twitter:description" content="Calculate your personalized carnivore macros. Free, private, no email required.">
    <meta name="twitter:image" content="https://carnivoreweekly.com/images/logo.png">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">

    <title>Free Carnivore Macro Calculator | Carnivore Weekly</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NR4JVKW2JV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NR4JVKW2JV');

        function trackCalculation(dietType, goal) {
            gtag('event', 'calculate', {
                'event_category': 'Calculator',
                'event_label': dietType + ' - ' + goal
            });
        }

        function trackUpgradeClick() {
            gtag('event', 'click', {
                'event_category': 'Upgrade',
                'event_label': 'AI Upgrade CTA'
            });
        }

        function trackAffiliateClick(product, link) {
            gtag('event', 'click', {
                'event_category': 'Affiliate',
                'event_label': product,
                'value': link
            });
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Page-specific styles */
        .container {
            max-width: 1200px;
        }

        /* FREE Star Badge */
        .free-badge {
            position: absolute;
            top: -25px;
            right: 30px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            color: #1a120b;
            padding: 20px 30px;
            border-radius: 50%;
            border: 4px solid #d4a574;
            box-shadow:
                0 8px 25px rgba(255, 215, 0, 0.6),
                0 4px 15px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.5);
            font-family: 'Playfair Display', serif;
            font-size: 1.1em;
            font-weight: 900;
            z-index: 10;
            text-align: center;
            line-height: 1.3;
            transform: rotate(-15deg);
            min-width: 120px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .free-badge::before {
            content: "‚òÖ";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            color: #ffd700;
            text-shadow:
                0 0 10px rgba(255, 215, 0, 0.8),
                2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .free-badge .big {
            font-size: 2em;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .free-badge .small {
            font-size: 0.7em;
            font-weight: 700;
            font-family: 'Merriweather', serif;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .free-badge {
                position: static;
                display: inline-flex;
                margin: 0 auto 20px;
                transform: rotate(-8deg);
            }
        }

        /* Introduction Section */
        .intro-section {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-left: 5px solid #d4a574;
            position: relative;
            z-index: 1;
        }

        .intro-section p {
            font-size: 1.05em;
            line-height: 1.8;
            color: #2c1810;
            margin-bottom: 18px;
        }

        .intro-section strong {
            color: #8b4513;
            font-weight: 700;
        }

        .intro-section em {
            color: #d4a574;
            font-style: italic;
        }

        /* Image beside text (reusable pattern) */
        .image-aside {
            float: right;
            margin: 0 0 25px 30px;
            max-width: 560px;
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Keep intro-image as alias for backwards compatibility */
        .intro-image {
            float: right;
            margin: 0 0 25px 30px;
            max-width: 560px;
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .intro-section {
                padding: 25px;
                margin-bottom: 30px;
            }

            .intro-section p {
                font-size: 1em;
            }

            .image-aside,
            .intro-image {
                float: none;
                margin: 0 0 20px 0;
                max-width: 100%;
            }
        }

        /* Card sections */
        .card {
            background: linear-gradient(135deg, #d4a574 0%, #c49a6c 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow:
                0 8px 25px rgba(0,0,0,0.5),
                inset 0 1px 0 rgba(255,255,255,0.3),
                inset 0 -1px 0 rgba(0,0,0,0.3);
            border: 3px solid #8b4513;
            position: relative;
        }

        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><filter id="noise2"><feTurbulence baseFrequency="0.6" numOctaves="3"/></filter><rect width="100%" height="100%" filter="url(%23noise2)" opacity="0.15"/></svg>');
            border-radius: 15px;
            pointer-events: none;
        }

        .card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2em;
            margin-bottom: 20px;
            color: #2c1810;
            border-bottom: 3px solid #8b4513;
            padding-bottom: 10px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
            position: relative;
            z-index: 1;
        }

        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        /* Form elements */
        label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c1810;
            font-size: 0.95em;
        }

        input, select {
            width: 100%;
            padding: 16px 15px;
            border-radius: 8px;
            border: 2px solid #8b4513;
            background: rgba(255,255,255,0.9);
            color: #2c1810;
            font-family: 'Merriweather', serif;
            font-size: 1em;
            transition: all 0.3s;
            min-height: 48px;
        }

        input:focus, select:focus {
            outline: 3px solid #d4a574;
            outline-offset: 2px;
            border-color: #8b4513;
            background: #fff;
            box-shadow: 0 0 10px rgba(212, 165, 116, 0.5);
        }

        .input-hint {
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: 5px;
            font-style: italic;
            color: #666;
        }

        /* Error messages */
        .error-text {
            display: none;
            font-size: 0.9em;
            color: #8b4513;
            margin-top: 5px;
            padding: 8px 12px;
            background: rgba(139, 69, 19, 0.1);
            border-left: 3px solid #8b4513;
            border-radius: 4px;
        }

        /* Form Section Cards - "Breathing Room" */
        .form-section-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            position: relative;
            z-index: 1;
        }

        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 20px;
            border-bottom: 1px solid #f3f4f6;
            padding-bottom: 12px;
            font-family: 'Playfair Display', serif;
        }

        /* Enhanced input styling */
        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="tel"],
        select {
            padding: 12px 16px !important;
            border: 1px solid #d1d5db !important;
            border-radius: 8px !important;
            font-size: 16px !important;
            background-color: #f9fafb !important;
            transition: all 0.2s !important;
            height: 44px !important;
            line-height: 20px !important;
        }

        textarea {
            padding: 12px 16px !important;
            border: 1px solid #d1d5db !important;
            border-radius: 8px !important;
            font-size: 16px !important;
            background-color: #f9fafb !important;
            transition: all 0.2s !important;
            min-height: 120px !important;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus,
        input[type="tel"]:focus,
        select:focus,
        textarea:focus {
            outline: none !important;
            border-color: #8b4513 !important;
            background-color: #fff !important;
            box-shadow: 0 0 0 4px rgba(139, 69, 19, 0.1) !important;
        }

        /* Upsell Container */
        .upsell-container {
            border: 2px solid #b91c1c;
            background: #fff1f2;
            padding: 40px;
            border-radius: 12px;
            margin-top: 50px;
            position: relative;
            z-index: 1;
        }

        .upsell-container h2 {
            color: #991b1b;
            margin-top: 0;
            margin-bottom: 30px;
            font-family: 'Playfair Display', serif;
            font-size: 2em;
        }

        .upsell-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 12px 0;
            font-size: 1.05em;
            color: #2c1810;
            border-bottom: 1px solid #fecaca;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list strong {
            color: #991b1b;
            font-weight: 700;
        }

        .price-box {
            text-align: center;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #fecaca;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }

        .price-original {
            text-decoration: line-through;
            color: #6b7280;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .price-final {
            font-size: 2.5rem;
            font-weight: bold;
            color: #b91c1c;
            margin-bottom: 20px;
            font-family: 'Playfair Display', serif;
        }

        .cta-button-pulse {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Merriweather', serif;
            box-shadow: 0 4px 6px rgba(185, 28, 28, 0.3);
        }

        .cta-button-pulse:hover {
            background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(185, 28, 28, 0.4);
        }

        @media (max-width: 768px) {
            .upsell-grid {
                grid-template-columns: 1fr;
            }

            .upsell-container {
                padding: 25px;
            }

            .form-section-card {
                padding: 20px;
            }
        }

        .error-text.show {
            display: block;
        }

        input[aria-invalid="true"],
        select[aria-invalid="true"] {
            border-color: #8b4513;
            border-width: 3px;
            background: rgba(139, 69, 19, 0.05);
        }

        /* Unit toggle */
        .unit-toggle {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #8b4513;
            width: fit-content;
        }

        .unit-toggle button {
            padding: 10px 20px;
            border: none;
            background: rgba(255,255,255,0.7);
            color: #2c1810;
            cursor: pointer;
            font-family: 'Merriweather', serif;
            font-weight: 700;
            transition: all 0.3s;
        }

        .unit-toggle button.active {
            background: #8b4513;
            color: #f4e4d4;
        }

        .unit-toggle button:hover:not(.active) {
            background: rgba(255,255,255,0.9);
        }

        /* Buttons */
        button {
            cursor: pointer;
            padding: 14px 28px;
            border-radius: 10px;
            border: 2px solid #8b4513;
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: #f4e4d4;
            font-weight: 700;
            font-family: 'Merriweather', serif;
            font-size: 1em;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }

        button.primary {
            background: linear-gradient(135deg, #2a5f2a 0%, #3a7f3a 100%);
            border-color: #4a9f4a;
            font-size: 1.1em;
        }

        button.secondary {
            background: rgba(255,255,255,0.9);
            color: #2c1810;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* Results display */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        .result-box {
            background: rgba(255,255,255,0.6);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .result-label {
            font-size: 0.9em;
            font-weight: 700;
            color: #2c1810;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .result-value {
            font-family: 'Playfair Display', serif;
            font-size: 2em;
            font-weight: 900;
            color: #8b4513;
        }

        .result-unit {
            font-size: 0.7em;
            opacity: 0.7;
        }

        /* Warnings and info boxes */
        .warning {
            background: rgba(255, 140, 0, 0.2);
            border-left: 4px solid #ff8c00;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        .success {
            background: rgba(144, 238, 144, 0.2);
            border-left: 4px solid #90ee90;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        .info {
            background: rgba(255,255,255,0.5);
            border-left: 4px solid #8b4513;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        /* Meal examples */
        .meal-example {
            background: rgba(255,255,255,0.7);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #8b4513;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .meal-example h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #8b4513;
        }

        .meal-example ul {
            list-style: none;
            padding-left: 0;
        }

        .meal-example li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }

        .meal-example li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 10px;
            color: #8b4513;
            font-weight: bold;
        }

        /* Timeline */
        .timeline-week {
            background: rgba(255,255,255,0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #8b4513;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .timeline-week h4 {
            font-family: 'Playfair Display', serif;
            color: #8b4513;
            margin-bottom: 8px;
        }

        /* Upgrade CTA */

        /* Hide/show elements */
        .hidden {
            display: none;
        }

        /* Disclaimer */
        .disclaimer {
            background: rgba(139, 69, 19, 0.2);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            font-size: 0.9em;
            position: relative;
            z-index: 1;
        }

        .disclaimer h3 {
            font-family: 'Playfair Display', serif;
            color: #8b4513;
            margin-bottom: 10px;
        }

        /* Print styles */
        @media print {
            /* Hide non-essential elements */
            body::before { display: none; }
            header { display: none !important; }
            footer { display: none !important; }
            nav { display: none !important; }
            .calculator-form { display: none !important; }
            #upgradeSection { display: none !important; }
            .free-badge { display: none !important; }

            /* Clean background for print */
            body {
                background: white;
                color: #000;
            }

            /* Show results section */
            #resultsSection {
                display: block !important;
                margin: 0;
                padding: 20px;
            }

            /* Print header with logo and branding */
            #resultsSection::before {
                content: '';
                display: block;
                width: 100%;
                padding: 30px 0;
                border-bottom: 3px solid #8b4513;
                margin-bottom: 30px;
                background:
                    linear-gradient(to right, transparent 0%, #d4a574 50%, transparent 100%)
                    no-repeat center bottom / 60% 2px;
            }

            /* Add logo and title at top */
            .container::before {
                content: 'CARNIVORE WEEKLY';
                display: block;
                font-family: 'Playfair Display', serif;
                font-size: 2em;
                font-weight: 900;
                text-align: center;
                color: #8b4513;
                margin-bottom: 5px;
                letter-spacing: 2px;
            }

            .container::after {
                content: 'Your Personalized Macro Plan';
                display: block;
                font-family: 'Merriweather', serif;
                font-size: 1em;
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #d4a574;
            }

            /* Clean card styling for print */
            .card {
                background: white;
                border: 2px solid #8b4513;
                box-shadow: none;
                page-break-inside: avoid;
                margin-bottom: 20px;
            }

            .card h3 {
                color: #8b4513;
                border-bottom: 2px solid #d4a574;
                padding-bottom: 10px;
            }

            /* Ensure readability */
            .macro-split {
                border: 1px solid #ddd;
            }

            .warning, .info {
                background: white;
                border: 2px solid #666;
                color: #000;
            }

            .meal-example {
                background: white;
                border: 2px solid #8b4513;
            }

            /* Footer note on print */
            #resultsSection::after {
                content: 'Generated at carnivoreweekly.com/calculator.html';
                display: block;
                margin-top: 40px;
                padding-top: 20px;
                border-top: 1px solid #ddd;
                text-align: center;
                font-size: 0.85em;
                color: #666;
            }

            /* Page breaks */
            .card { page-break-inside: avoid; }
            h3 { page-break-after: avoid; }
        }

        /* Center header subtitle */
        header p {
            text-align: center;
        }
    </style>

    <!-- Schema.org WebApplication markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Carnivore Diet Macro Calculator",
      "description": "Free carnivore diet macro calculator - calculate personalized protein, fat, and calorie targets",
      "url": "https://carnivoreweekly.com/calculator.html",
      "applicationCategory": "HealthApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Personalized macro calculation",
        "Imperial/Metric conversion",
        "Activity level adjustment",
        "Diet-specific recommendations",
        "Meal examples"
      ]
    }
    </script>
</head>
<body>
    <header>
        <div class="container">
            <img src="images/logo.png" alt="Carnivore Weekly Logo" class="logo">
            <h1>CALCULATOR</h1>
            <p class="subtitle">Macro Calculator</p>
        </div>
    </header>

    <!-- Navigation Menu -->
    <nav class="nav-menu">
        <a href="index.html">Home</a>
        <a href="channels.html">Channels</a>
        <a href="wiki.html">Wiki</a>
        <a href="blog.html">Blog</a>
        <a href="calculator.html" class="active">Calculator</a>
        <a href="archive.html">Archive</a>
        <a href="about.html">About</a>
    </nav>

    <!-- Fixed Side Feedback Button -->
    <a href="https://forms.gle/RTzpnv4PvaP1TEZt7" target="_blank" rel="noopener noreferrer" class="feedback-btn feedback-side feedback-btn-small">
        üí¨ Feedback
    </a>

    <main>
        <div class="container">
            <!-- Introduction Section -->
            <section class="intro-section">
                <p>I made this calculator because I kept getting <strong>pissed off</strong>.</p>

                <p>You know how it goes. You're trying to figure out your macros, so you Google "carnivore diet calculator" or whatever. You find one that looks decent. Start filling it out. Age, weight, activity level... getting into it. Then BAM ‚Äì paywall. Or worse, "Thanks! We'll email you the results!"</p>

                <p>Yeah, no. I'm not giving you my email so you can spam me about your coaching program.</p>

                <p>So here's what I built:</p>

                <img src="shopping-cart.png" alt="Shopping cart filled with carnivore foods including meat, butter, and eggs" class="intro-image">

                <p><strong>The free version</strong> gives you what you actually came for. Your daily macro targets. That's it. No email required, no games. If that's all you need, you're done in 2 minutes.</p>

                <p>But if you want to go deeper ‚Äì and I mean <em>really</em> deep ‚Äì there's a paid version for <strong>$9.99</strong>. We keep asking questions and then I basically drop everything I know on you. Meal timing, supplement suggestions, troubleshooting strategies, the whole deal. It's all AI-powered on the backend, which costs me money to run, so I have to charge something.</p>

                <p><strong>Here's the catch:</strong> Your detailed report sticks around for 48 hours so you can come back and reference it. After that, it's gone. I'm not storing your data long-term, and I'm not building a profile on you. You get what you paid for, you save it if you want it, and then it disappears.</p>

                <p><strong>Full transparency:</strong> This price will probably go up once I dial everything in and add more features. Right now I'm more interested in seeing how well it works and getting feedback than making a profit. Think of it as early access pricing.</p>

                <p><strong>The deal:</strong> Use the free version if you just need the basics. Grab the paid version if you want me to dump my brain on your specific situation. Either way, no bullshit, no email harvesting, no bait and switch.</p>

                <p style="margin-top: 25px; font-size: 1.15em;"><strong>Now let's figure out what your body needs.</strong></p>
            </section>

            <!-- Calculator Card -->
            <div class="card" style="position: relative;">
                <!-- FREE Star Badge -->
                <div class="free-badge">
                    <div class="big">FREE!</div>
                    <div class="small">No email required</div>
                </div>

                <h2>Calculate Your Macros</h2>

                <!-- Unit Toggle -->
                <div class="unit-toggle">
                    <button id="imperialBtn" class="active" onclick="setUnits('imperial')">Imperial (lbs/in)</button>
                    <button id="metricBtn" onclick="setUnits('metric')">Metric (kg/cm)</button>
                </div>

                <!-- Input Form -->
                <div class="grid-2">
                    <div>
                        <label for="sex">Sex</label>
                        <select id="sex">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div>
                        <label for="age">Age</label>
                        <input type="number" id="age" min="14" max="99" value="35" inputmode="numeric" autocomplete="off">
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label>Height <span id="heightUnit">(feet & inches)</span></label>
                        <div id="imperialHeight" style="display: flex; gap: 10px;">
                            <div style="flex: 1;">
                                <input type="number" id="heightFeet" min="3" max="8" value="5" inputmode="numeric" autocomplete="off" aria-label="Feet">
                            </div>
                            <div style="flex: 1;">
                                <input type="number" id="heightInches" min="0" max="11" value="10" inputmode="numeric" autocomplete="off" aria-label="Inches">
                            </div>
                        </div>
                        <input type="number" id="heightCm" min="120" max="230" value="178" step="1" class="hidden" inputmode="numeric" autocomplete="off">
                        <p class="input-hint" id="height-hint">Example: 5 feet 10 inches</p>
                    </div>
                    <div>
                        <label for="weight">Weight <span id="weightUnit">(lbs)</span></label>
                        <input type="number" id="weight" value="180" step="0.1" inputmode="decimal" autocomplete="off">
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="lifestyle">Daily Lifestyle</label>
                        <select id="lifestyle" onchange="updateActivityDisplay()" aria-describedby="lifestyle-hint">
                            <option value="1.2" selected>Desk job, minimal walking</option>
                            <option value="1.3">Desk job, walk 30-60 min/day</option>
                            <option value="1.4">Standing job (retail, teaching)</option>
                            <option value="1.5">Active job (server, nurse, on feet all day)</option>
                            <option value="1.6">Physical labor (construction, farming)</option>
                        </select>
                        <p class="input-hint" id="lifestyle-hint">Your occupation, not gym time</p>
                    </div>
                    <div>
                        <label for="exercise">Structured Exercise</label>
                        <select id="exercise" onchange="updateActivityDisplay()" aria-describedby="exercise-hint">
                            <option value="0">None</option>
                            <option value="0.1">1-2x/week, light (walking, yoga)</option>
                            <option value="0.2">3-4x/week, moderate (lifting, jogging)</option>
                            <option value="0.3" selected>4-5x/week, intense (CrossFit, HIIT)</option>
                            <option value="0.4">6-7x/week, athlete (serious training)</option>
                        </select>
                        <p class="input-hint" id="exercise-hint">Gym sessions only, not daily movement</p>
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="goal">Goal</label>
                        <select id="goal" onchange="updateDeficitLabel()">
                            <option value="lose" selected>Lose Fat</option>
                            <option value="maintain">Maintain Weight</option>
                            <option value="gain">Gain Muscle</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; padding: 10px; background: rgba(212, 165, 116, 0.1); border-radius: 8px; border: 1px solid rgba(212, 165, 116, 0.3);">
                        <p style="margin: 0; font-size: 0.9em; color: #d4a574; text-align: center;">
                            <strong>Total Activity:</strong> <span id="activityDisplay">1.5x BMR</span>
                        </p>
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="deficit" id="deficitLabel">Calorie Deficit (%)</label>
                        <input type="number" id="deficit" min="0" max="40" value="0" step="5" inputmode="numeric" autocomplete="off" aria-describedby="deficit-hint">
                        <p class="input-hint" id="deficit-hint">15-25% is sustainable for most people</p>
                    </div>
                    <div>
                        <label for="diet">Diet Style</label>
                        <select id="diet" onchange="updateDietOptions()">
                            <option value="carnivore" selected>Carnivore (0-5g carbs)</option>
                            <option value="keto">Keto (~20g net carbs)</option>
                            <option value="lowcarb">Low-Carb (~75g net carbs)</option>
                        </select>
                    </div>
                </div>

                <!-- Carnivore-specific options -->
                <div id="carnivoreOptions">
                    <div class="grid-2">
                        <div>
                            <label for="ratio">Fat/Protein Ratio (by calories)</label>
                            <select id="ratio">
                                <option value="65-35">65% fat / 35% protein (leaner)</option>
                                <option value="70-30" selected>70% fat / 30% protein (standard)</option>
                                <option value="80-20">80% fat / 20% protein (therapeutic/satiety)</option>
                            </select>
                        </div>
                        <div>
                            <label for="proteinMin">Protein Minimum</label>
                            <select id="proteinMin">
                                <option value="1.6" selected>1.6 g/kg (0.7 g/lb) - Standard</option>
                                <option value="1.8">1.8 g/kg (0.8 g/lb) - Active</option>
                                <option value="2.2">2.2 g/kg (1.0 g/lb) - Athlete</option>
                            </select>
                            <p class="input-hint">Enforces minimum protein to prevent muscle loss</p>
                        </div>
                    </div>
                </div>

                <!-- Keto/Low-carb options -->
                <div id="ketoOptions" class="hidden">
                    <div class="grid-2">
                        <div>
                            <label for="netCarbs">Net Carbs (g/day)</label>
                            <input type="number" id="netCarbs" min="0" max="150" value="20">
                        </div>
                        <div>
                            <label for="proteinSetting">Protein Target</label>
                            <select id="proteinSetting">
                                <option value="1.6" selected>1.6 g/kg (0.7 g/lb) - Standard</option>
                                <option value="1.8">1.8 g/kg (0.8 g/lb) - Active</option>
                                <option value="2.2">2.2 g/kg (1.0 g/lb) - Athlete</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="primary" onclick="calculate()">Calculate My Macros</button>
                    <button class="secondary" onclick="resetForm()">Reset</button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden">
                <div class="card">
                    <h2>Your Personalized Macros</h2>

                    <div class="results-grid">
                        <div class="result-box">
                            <div class="result-label">Daily Calories</div>
                            <div class="result-value" id="outCalories">‚Äî</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">TDEE (Maintenance)</div>
                            <div class="result-value" id="outTdee">‚Äî</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Protein</div>
                            <div class="result-value"><span id="outProtein">‚Äî</span><span class="result-unit">g</span></div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Fat</div>
                            <div class="result-value"><span id="outFat">‚Äî</span><span class="result-unit">g</span></div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Net Carbs</div>
                            <div class="result-value"><span id="outCarbs">‚Äî</span><span class="result-unit">g</span></div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Macro Split</div>
                            <div class="result-value" id="outSplit" style="font-size: 1.2em;">‚Äî</div>
                        </div>
                    </div>

                    <!-- ButcherBox Affiliate Ad -->
                    <div style="margin: 40px 0; text-align: center;">
                        <a href="https://butcherbox.pxf.io/Z6oVMR?utm_source=carnivore_weekly&utm_medium=affiliate&utm_campaign=calculator_results" target="_blank" rel="noopener" onclick="trackAffiliateClick('ButcherBox', 'https://butcherbox.pxf.io/Z6oVMR')">
                            <img src="butcherbox-ad.jpeg" alt="ButcherBox: Steaks Of Your Choice Free in Every Box For a Year" style="width: 100%; max-width: 600px; height: auto; display: inline-block; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.5);">
                        </a>
                    </div>

                    <!-- Warnings/Success Messages -->
                    <div id="flagsContainer"></div>

                    <div class="btn-group no-print">
                        <button onclick="window.print()">üñ®Ô∏è Print Summary</button>
                        <button class="secondary" onclick="scrollToUpgrade()">See AI Upgrade</button>
                    </div>
                </div>

                <!-- What This Looks Like -->
                <div class="card" id="mealExamples">
                    <h2>What This Looks Like on Your Plate</h2>
                    <div id="mealExamplesContent">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- Electrolyte Guidance -->
                <div class="card">
                    <h2>Electrolyte Targets (Critical for Success)</h2>
                    <p class="info">Most carnivore beginners underestimate electrolytes. Getting these right prevents headaches, cramps, and fatigue.</p>

                    <div class="grid-3">
                        <div class="result-box">
                            <div class="result-label">Sodium</div>
                            <div class="result-value">5000<span class="result-unit">mg</span></div>
                            <p style="margin-top: 10px; font-size: 0.9em;">2-3 tsp salt per day</p>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Potassium</div>
                            <div class="result-value">3500<span class="result-unit">mg</span></div>
                            <p style="margin-top: 10px; font-size: 0.9em;">Beef, fish, avocado</p>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Magnesium</div>
                            <div class="result-value">400<span class="result-unit">mg</span></div>
                            <p style="margin-top: 10px; font-size: 0.9em;">Supplement recommended</p>
                        </div>
                    </div>

                    <div class="info" style="margin-top: 20px;">
                        <strong>Easy wins:</strong> Salt your food generously, drink bone broth, eat fatty fish (salmon, sardines). If you get headaches or feel weak, add more salt first.
                    </div>

                    <!-- LMNT Affiliate -->
                    <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #ffd700 0%, #d4a574 100%); border-radius: 12px; border: 3px solid #8b4513;">
                        <h3 style="margin: 0 0 10px 0; color: #1a120b; font-family: 'Playfair Display', serif;">‚ö° The Easy Button for Electrolytes</h3>
                        <p style="margin: 0 0 15px 0; color: #2c1810; font-size: 1em; line-height: 1.6;">
                            <strong>LMNT</strong> is specifically formulated for low-carb diets. Zero sugar, optimal sodium ratio, tastes great. Used by athletes and carnivores worldwide.
                        </p>
                        <a href="http://elementallabs.refr.cc/default/u/michelbrew"
                           target="_blank"
                           rel="noopener noreferrer"
                           onclick="gtag('event', 'click', {'event_category': 'Affiliate', 'event_label': 'LMNT - Calculator', 'value': 'http://elementallabs.refr.cc/default/u/michelbrew'});"
                           style="display: inline-block; background: #1a120b; color: #ffd700; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 1.1em; transition: all 0.3s;">
                            Try LMNT - Get Free Sample Pack ‚Üí
                        </a>
                        <p style="margin: 15px 0 0 0; font-size: 0.85em; color: #2c1810; opacity: 0.8;">
                            Affiliate link - Supports this free calculator
                        </p>
                    </div>
                </div>

                <!-- Adaptation Timeline -->
                <div class="card">
                    <h2>First 4 Weeks: What to Expect</h2>

                    <div class="timeline-week">
                        <h4>Week 1: The Suck</h4>
                        <p>Headaches, fatigue, possible diarrhea. This is normal. Your body is switching fuel sources. Double your salt intake. Rest more. Don't quit.</p>
                    </div>

                    <div class="timeline-week">
                        <h4>Week 2: Stabilizing</h4>
                        <p>Energy starts returning. Digestion regulating. Cravings for carbs peaking then fading. Hunger might spike - this is temporary. Stay the course.</p>
                    </div>

                    <div class="timeline-week">
                        <h4>Week 3: Momentum</h4>
                        <p>Mental clarity improving. Energy more stable. Body composition changes visible. You're fat-adapted now. Appetite naturally regulating.</p>
                    </div>

                    <div class="timeline-week">
                        <h4>Week 4: The Shift</h4>
                        <p>This feels sustainable. Hunger signals are clear. You eat when hungry, stop when full. Weight loss (if that's your goal) is consistent. You're dialed in.</p>
                    </div>

                    <div class="warning">
                        <strong>Common Mistake:</strong> Quitting during Week 1-2 because you feel terrible. That's adaptation, not failure. Give it 30 days minimum before judging results.
                    </div>
                </div>

                <!-- Common Mistakes -->
                <div class="card">
                    <h2>Common Mistakes (Avoid These)</h2>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Not Enough Salt</strong><br>
                        You need 2-3 teaspoons per day. If you get headaches, add salt first before assuming carnivore doesn't work for you.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Too Lean</strong><br>
                        Fat is your primary fuel. If you only eat chicken breast, you'll be hungry and miserable. Eat fatty cuts (ribeye, ground beef 80/20, salmon).
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Not Eating Enough</strong><br>
                        Especially in the first month, eat when hungry. Don't force a deficit while adapting. Your appetite will naturally regulate after you're fat-adapted.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Quitting Too Soon</strong><br>
                        Week 1-2 can feel rough. That's your body adapting, not failing. Give it 30 days minimum before deciding if this works for you.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Overcomplicating It</strong><br>
                        You don't need fancy recipes. Steak. Eggs. Ground beef. Salt. That's it. Save the gourmet carnivore pizza experiments for month 3.
                    </div>
                </div>
            </div>

            <!-- AI Upgrade CTA -->
            <div id="upgradeSection" class="upsell-container no-print hidden">
                <h2>Get Your Complete Personalized 30-Day Protocol</h2>

                <div class="upsell-grid">
                    <!-- Features Column -->
                    <div>
                        <ul class="feature-list">
                            <li>‚úÖ <strong>30-Day Meal Plan</strong> - Matched to your exact macros & preferences</li>
                            <li>‚úÖ <strong>Weekly Grocery Lists</strong> - With portions & cost estimates</li>
                            <li>‚úÖ <strong>Doctor's Consultation Script</strong> - Labs to request, questions to ask</li>
                            <li>‚úÖ <strong>Stall-Breaker Decision Tree</strong> - What to check when progress stops</li>
                            <li>‚úÖ <strong>Research Guide</strong> - Studies explained in plain English</li>
                            <li>‚úÖ <strong>Printable PDF</strong> - All 13 reports, one organized document</li>
                        </ul>
                    </div>

                    <!-- Price Box Column -->
                    <div class="price-box">
                        <div>
                            <div class="price-original">$29.99</div>
                            <div class="price-final">$9.99</div>
                            <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">Limited time offer</p>
                        </div>
                        <button class="cta-button-pulse" onclick="upgradeClick()">Get My Plan Now</button>
                        <p style="font-size: 0.8em; color: #666; margin-top: 15px;">One-time payment<br>No subscription</p>
                    </div>
                </div>

                <!-- Privacy Note -->
                <div style="margin-top: 30px; padding: 15px; background: rgba(185, 28, 28, 0.05); border: 1px solid #fecaca; border-radius: 8px;">
                    <p style="font-size: 0.95em; margin: 0; color: #2c1810;">
                        üîí <strong>Your data is secure</strong><br>
                        <span style="font-size: 0.9em; opacity: 0.8; margin-top: 8px; display: block;">Download your PDF anytime. Automatically deleted after 48 hours. No email required.</span>
                    </p>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer style="background: linear-gradient(135deg, #4a2511 0%, #6d3819 50%, #8b4513 100%); color: #f4e4d4; padding: 40px 20px; text-align: center; margin-top: 60px; border-top: 4px solid #8b4513;">
        <div style="width: 100%; max-width: 1200px; margin: 0 auto;">
            <p style="font-family: 'Playfair Display', serif; font-size: 1.5em; font-weight: 700; margin-bottom: 10px;">CARNIVORE WEEKLY</p>
            <p style="opacity: 0.9;">The Finest Carnivore Content, Curated Weekly</p>
            <nav style="margin-top: 20px; opacity: 0.8;">
                <a href="index.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Home</a>
                <a href="channels.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Channels</a>
                <a href="wiki.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Wiki</a>
                <a href="calculator.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Calculator</a>
                <a href="about.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">About</a>
                <a href="archive.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Archive</a>
            </nav>
            <p style="margin-top: 15px; font-size: 0.85em; opacity: 0.7;">
                <a href="privacy.html" style="color: #d4a574; text-decoration: none;">Privacy Policy</a>
            </p>

            <!-- Disclaimers -->
            <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(212, 165, 116, 0.3); max-width: 800px; margin-left: auto; margin-right: auto;">
                <p style="font-size: 0.85em; opacity: 0.7; margin-bottom: 15px; line-height: 1.6;">
                    <strong style="color: #d4a574;">Medical Disclaimer:</strong> This calculator provides estimates based on research-validated formulas. Results vary by individual. Always consult your healthcare provider before starting any new diet, especially if you have existing health conditions or take medications.
                </p>
                <p style="font-size: 0.85em; opacity: 0.7; margin-bottom: 15px; line-height: 1.6;">
                    <strong style="color: #d4a574;">Privacy First:</strong> All calculations happen in your browser. We don't store, track, or collect your personal data. Ever.
                </p>
                <p style="font-size: 0.75em; opacity: 0.6; line-height: 1.6;">
                    Macro calculations use the Mifflin-St Jeor equation (gold standard for BMR) and carnivore-specific ratios validated by peer-reviewed research. Your actual needs may differ based on genetics, metabolic health, and activity patterns.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // ---------- State ----------
        let currentUnits = 'imperial';
        let currentResults = null;

        // ---------- Unit Conversion ----------
        function setUnits(units) {
            currentUnits = units;
            document.getElementById('imperialBtn').classList.toggle('active', units === 'imperial');
            document.getElementById('metricBtn').classList.toggle('active', units === 'metric');

            const imperialHeight = document.getElementById('imperialHeight');
            const heightCm = document.getElementById('heightCm');
            const weightInput = document.getElementById('weight');
            const heightUnit = document.getElementById('heightUnit');
            const weightUnit = document.getElementById('weightUnit');
            const heightHint = document.getElementById('heightHint');

            if (units === 'imperial') {
                // Show feet/inches inputs, hide cm
                imperialHeight.style.display = 'flex';
                heightCm.classList.add('hidden');
                heightUnit.textContent = '(feet & inches)';
                weightUnit.textContent = '(lbs)';
                heightHint.textContent = 'Example: 5 feet 10 inches';

                // Convert weight if switching from metric
                if (weightInput.value && weightInput.value < 100) {
                    weightInput.value = Math.round(parseFloat(weightInput.value) * 2.205);
                } else if (!weightInput.value) {
                    weightInput.value = 180;
                }
            } else {
                // Show cm input, hide feet/inches
                imperialHeight.style.display = 'none';
                heightCm.classList.remove('hidden');
                heightUnit.textContent = '(cm)';
                weightUnit.textContent = '(kg)';
                heightHint.textContent = '178 cm = 5\'10"';

                // Convert from feet/inches to cm
                const feet = parseInt(document.getElementById('heightFeet').value) || 5;
                const inches = parseInt(document.getElementById('heightInches').value) || 10;
                const totalInches = (feet * 12) + inches;
                heightCm.value = Math.round(totalInches * 2.54);

                // Convert weight if switching from imperial
                if (weightInput.value && weightInput.value > 100) {
                    weightInput.value = Math.round(parseFloat(weightInput.value) / 2.205);
                } else if (!weightInput.value) {
                    weightInput.value = 82;
                }
            }
        }

        // ---------- UI Updates ----------
        function updateActivityDisplay() {
            const lifestyle = parseFloat(document.getElementById('lifestyle').value);
            const exercise = parseFloat(document.getElementById('exercise').value);
            const total = lifestyle + exercise;
            document.getElementById('activityDisplay').textContent = total.toFixed(2) + 'x BMR';
        }

        function updateDeficitLabel() {
            const goal = document.getElementById('goal').value;
            const label = document.getElementById('deficitLabel');
            const input = document.getElementById('deficit');

            if (goal === 'lose') {
                label.textContent = 'Calorie Deficit (%)';
                input.value = 20;
            } else if (goal === 'gain') {
                label.textContent = 'Calorie Surplus (%)';
                input.value = 10;
            } else {
                label.textContent = 'Adjustment (%)';
                input.value = 0;
            }
        }

        function updateDietOptions() {
            const diet = document.getElementById('diet').value;
            const carnivoreOptions = document.getElementById('carnivoreOptions');
            const ketoOptions = document.getElementById('ketoOptions');

            if (diet === 'carnivore') {
                carnivoreOptions.classList.remove('hidden');
                ketoOptions.classList.add('hidden');
            } else {
                carnivoreOptions.classList.add('hidden');
                ketoOptions.classList.remove('hidden');

                if (diet === 'keto') {
                    document.getElementById('netCarbs').value = 20;
                } else if (diet === 'lowcarb') {
                    document.getElementById('netCarbs').value = 75;
                }
            }
        }

        // ---------- Calculations ----------
        function round(n, decimals = 0) {
            const factor = Math.pow(10, decimals);
            return Math.round(n * factor) / factor;
        }

        function clamp(n, min, max) {
            return Math.max(min, Math.min(max, n));
        }

        function getWeightKg() {
            const weight = parseFloat(document.getElementById('weight').value);
            return currentUnits === 'imperial' ? weight / 2.205 : weight;
        }

        function getHeightCm() {
            if (currentUnits === 'imperial') {
                const feet = parseInt(document.getElementById('heightFeet').value) || 0;
                const inches = parseInt(document.getElementById('heightInches').value) || 0;
                const totalInches = (feet * 12) + inches;
                return totalInches * 2.54;
            } else {
                return parseFloat(document.getElementById('heightCm').value) || 0;
            }
        }

        function calculateBMR(sex, age, heightCm, weightKg) {
            const s = sex === 'male' ? 5 : -161;
            return (10 * weightKg) + (6.25 * heightCm) - (5 * age) + s;
        }

        function calculateTDEE(bmr, activityMultiplier) {
            return bmr * activityMultiplier;
        }

        function applyGoal(tdee, goal, deficitPct) {
            const pct = clamp(deficitPct, 0, 40) / 100;
            if (goal === 'lose') return tdee * (1 - pct);
            if (goal === 'gain') return tdee * (1 + pct);
            return tdee;
        }

        function calculateMacros(calories, diet, weightKg) {
            let protein_g, fat_g, carbs_g;

            if (diet === 'carnivore') {
                const ratio = document.getElementById('ratio').value;
                const [fatPct, protPct] = ratio.split('-').map(x => parseInt(x) / 100);
                const proteinMin = parseFloat(document.getElementById('proteinMin').value);

                let protein_cal = calories * protPct;
                protein_g = protein_cal / 4;

                const minProtein = proteinMin * weightKg;
                if (protein_g < minProtein) {
                    protein_g = minProtein;
                    protein_cal = protein_g * 4;
                }

                const fat_cal = Math.max(0, calories - protein_cal);
                fat_g = fat_cal / 9;
                carbs_g = 0;

            } else {
                const netCarbs = parseFloat(document.getElementById('netCarbs').value);
                const proteinSetting = parseFloat(document.getElementById('proteinSetting').value);

                carbs_g = clamp(netCarbs, 0, 150);
                protein_g = proteinSetting * weightKg;

                const carbs_cal = carbs_g * 4;
                const protein_cal = protein_g * 4;
                const fat_cal = Math.max(0, calories - carbs_cal - protein_cal);
                fat_g = fat_cal / 9;
            }

            return { protein_g, fat_g, carbs_g };
        }

        function calculateSplit(calories, protein_g, fat_g, carbs_g) {
            const pCal = protein_g * 4;
            const fCal = fat_g * 9;
            const cCal = carbs_g * 4;
            const total = Math.max(1, calories);

            return {
                p: round((pCal / total) * 100, 0),
                f: round((fCal / total) * 100, 0),
                c: round((cCal / total) * 100, 0)
            };
        }

        function generateFlags(bmr, calories, goal, deficitPct, protein_g, weightKg) {
            const flags = [];

            const deficit = goal === 'lose' ? deficitPct : 0;
            const surplus = goal === 'gain' ? deficitPct : 0;

            if (deficit > 30) {
                flags.push({ type: 'warning', text: `${deficit}% deficit is aggressive. Consider 15-25% unless you enjoy suffering.` });
            }
            if (surplus > 20) {
                flags.push({ type: 'warning', text: `${surplus}% surplus is a fast bulk. If you hate gaining fat, try 5-15%.` });
            }
            if (goal === 'lose' && calories < bmr * 1.1) {
                flags.push({ type: 'warning', text: `Calories are under your BMR. You might feel terrible. Consider a smaller deficit.` });
            }

            const proteinMin = 1.6 * weightKg;
            if (protein_g < proteinMin) {
                flags.push({ type: 'warning', text: `Protein is under 1.6 g/kg baseline. You might lose muscle. Increase protein.` });
            }
            if (protein_g > 2.6 * weightKg) {
                flags.push({ type: 'warning', text: `Protein is very high (>2.6 g/kg). Not harmful, but you might feel better with more fat.` });
            }

            if (flags.length === 0) {
                flags.push({ type: 'success', text: `Looks good. Now go eat like the apex predator you are.` });
            }

            return flags;
        }

        // ---------- Main Calculate Function ----------
        function calculate() {
            // Get inputs
            const sex = document.getElementById('sex').value;
            const age = clamp(parseInt(document.getElementById('age').value), 14, 99);
            const heightCm = getHeightCm();
            const weightKg = getWeightKg();
            const lifestyle = parseFloat(document.getElementById('lifestyle').value);
            const exercise = parseFloat(document.getElementById('exercise').value);
            const activity = lifestyle + exercise;
            const goal = document.getElementById('goal').value;
            const deficitPct = clamp(parseFloat(document.getElementById('deficit').value), 0, 40);
            const diet = document.getElementById('diet').value;

            // Calculate
            const bmr = calculateBMR(sex, age, heightCm, weightKg);
            const tdee = calculateTDEE(bmr, activity);
            const calories = applyGoal(tdee, goal, deficitPct);
            const { protein_g, fat_g, carbs_g } = calculateMacros(calories, diet, weightKg);
            const split = calculateSplit(calories, protein_g, fat_g, carbs_g);

            // Store results
            currentResults = {
                bmr: round(bmr, 0),
                tdee: round(tdee, 0),
                calories: round(calories, 0),
                protein_g: round(protein_g, 0),
                fat_g: round(fat_g, 0),
                carbs_g: round(carbs_g, 0),
                split,
                diet,
                goal,
                weightKg
            };

            // Display results
            document.getElementById('outCalories').textContent = currentResults.calories.toLocaleString();
            document.getElementById('outTdee').textContent = currentResults.tdee.toLocaleString();
            document.getElementById('outProtein').textContent = currentResults.protein_g.toLocaleString();
            document.getElementById('outFat').textContent = currentResults.fat_g.toLocaleString();
            document.getElementById('outCarbs').textContent = currentResults.carbs_g.toLocaleString();
            document.getElementById('outSplit').textContent = `${split.f}% / ${split.p}% / ${split.c}%`;

            // Generate flags
            const flags = generateFlags(bmr, calories, goal, deficitPct, protein_g, weightKg);
            const flagsHTML = flags.map(f => {
                const className = f.type === 'warning' ? 'warning' : 'success';
                return `<div class="${className}"><strong>${f.type === 'warning' ? '‚ö†Ô∏è' : '‚úì'}</strong> ${f.text}</div>`;
            }).join('');
            document.getElementById('flagsContainer').innerHTML = flagsHTML;

            // Generate meal examples
            generateMealExamples();

            // Show results
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('upgradeSection').classList.remove('hidden');

            // Track event
            trackCalculation(diet, goal);

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // ---------- Meal Examples Generation ----------
        function generateMealExamples() {
            if (!currentResults) return;

            const { calories, protein_g, fat_g, diet } = currentResults;

            let examples = [];

            if (diet === 'carnivore') {
                // 2-meal carnivore day
                const caloriesPerMeal = Math.round(calories / 2);
                const proteinPerMeal = Math.round(protein_g / 2);
                const fatPerMeal = Math.round(fat_g / 2);

                // Meat portions based on protein content
                // Ribeye: ~6g protein/oz, Ground beef 80/20: ~5g protein/oz
                const ribeyeOz = Math.round(proteinPerMeal / 6);
                const groundBeefOz = Math.round(proteinPerMeal / 5);

                // 3-meal portions (protein/oz: ground beef ~5g, salmon/beef ~6-7g)
                const lunchBeefOz = Math.round((protein_g / 3) / 5);
                const dinnerBeefOz = Math.round((protein_g / 3) / 6);

                examples = [
                    {
                        title: `2-Meal Carnivore Day (${calories} cal)`,
                        meals: [
                            `<strong>Meal 1 (${caloriesPerMeal} cal):</strong> ${ribeyeOz}oz ribeye steak + 3-4 eggs cooked in butter`,
                            `<strong>Meal 2 (${caloriesPerMeal} cal):</strong> ${groundBeefOz}oz ground beef (80/20) + 2oz cheese`,
                            `<strong>Salt:</strong> Generously on everything`,
                            `<strong>Beverages:</strong> Water, black coffee, bone broth`
                        ]
                    },
                    {
                        title: `Simple 3-Meal Plan`,
                        meals: [
                            `<strong>Breakfast:</strong> 4-6 eggs scrambled in butter + ${Math.round(protein_g / 3 / 6)}oz bacon`,
                            `<strong>Lunch:</strong> ${lunchBeefOz}oz burger patties (no bun) + cheese`,
                            `<strong>Dinner:</strong> ${dinnerBeefOz}oz salmon or beef + butter`,
                            `<strong>Tip:</strong> Eat fatty cuts. Skip lean meats.`
                        ]
                    }
                ];
            } else {
                // Keto/Low-carb examples
                examples = [
                    {
                        title: `${diet === 'keto' ? 'Keto' : 'Low-Carb'} Day Example`,
                        meals: [
                            `<strong>Breakfast:</strong> 3-4 eggs + avocado + spinach`,
                            `<strong>Lunch:</strong> ${Math.round(protein_g / 3)}g chicken thighs + mixed greens salad + olive oil`,
                            `<strong>Dinner:</strong> ${Math.round(protein_g / 3)}g beef or fish + roasted vegetables + butter`,
                            `<strong>Snack (if needed):</strong> Cheese, nuts (measured), or hard-boiled eggs`
                        ]
                    }
                ];
            }

            const html = examples.map(ex => `
                <div class="meal-example">
                    <h4>${ex.title}</h4>
                    <ul>
                        ${ex.meals.map(m => `<li>${m}</li>`).join('')}
                    </ul>
                </div>
            `).join('');

            document.getElementById('mealExamplesContent').innerHTML = html;
        }

        // ---------- Helper Functions ----------
        function resetForm() {
            if (currentUnits === 'imperial') {
                document.getElementById('heightFeet').value = 5;
                document.getElementById('heightInches').value = 10;
                document.getElementById('weight').value = 180;
            } else {
                document.getElementById('heightCm').value = 178;
                document.getElementById('weight').value = 82;
            }
            document.getElementById('age').value = 35;
            document.getElementById('sex').value = 'male';
            document.getElementById('lifestyle').value = '1.2';
            document.getElementById('exercise').value = '0.3';
            document.getElementById('goal').value = 'lose';
            document.getElementById('deficit').value = 0;
            document.getElementById('diet').value = 'carnivore';
            document.getElementById('ratio').value = '70-30';
            document.getElementById('proteinMin').value = '1.6';

            updateDietOptions();
            updateDeficitLabel();
            updateActivityDisplay();

            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('upgradeSection').classList.add('hidden');
        }

        function scrollToUpgrade() {
            document.getElementById('upgradeSection').scrollIntoView({ behavior: 'smooth' });
        }

        function upgradeClick() {
            trackUpgradeClick();

            // Save current macro results to localStorage for questionnaire
            if (currentResults) {
                localStorage.setItem('carnivore_macros', JSON.stringify(currentResults));
            }

            // Redirect to Stripe checkout
            window.location.href = 'https://buy.stripe.com/dRm3cv7OHalA8FM092ao801';
        }

        // ---------- Payment Success Handling ----------
        function checkPaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);

            if (urlParams.get('success') === 'true') {
                // Redirect to questionnaire page
                window.location.href = 'questionnaire.html';
            }

            if (urlParams.get('cancelled') === 'true') {
                // Show cancelled message
                const cancelMsg = document.createElement('div');
                cancelMsg.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: rgba(139, 69, 19, 0.95);
                        color: #f4e4d4;
                        padding: 20px 30px;
                        border-radius: 10px;
                        border: 2px solid #d4a574;
                        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                        z-index: 10000;
                        max-width: 350px;
                    ">
                        <p style="margin: 0; font-size: 1em;">
                            Payment cancelled. No worries! The free calculator is still here whenever you need it.
                        </p>
                        <button onclick="this.parentElement.remove(); window.history.replaceState({}, '', '/calculator.html');" style="
                            margin-top: 15px;
                            background: #d4a574;
                            color: #1a120b;
                            border: none;
                            padding: 8px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: bold;
                        ">Close</button>
                    </div>
                `;
                document.body.appendChild(cancelMsg);

                // Auto-dismiss after 5 seconds
                setTimeout(() => {
                    if (cancelMsg.parentElement) {
                        cancelMsg.remove();
                        window.history.replaceState({}, '', '/calculator.html');
                    }
                }, 5000);
            }
        }

        // ---------- Init ----------
        updateDietOptions();
        updateDeficitLabel();
        updateActivityDisplay();
        checkPaymentStatus();
    </script>
</body>
</html>
