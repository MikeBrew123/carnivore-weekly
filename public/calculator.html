<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Meta Tags -->
    <meta name="description" content="Free carnivore diet macro calculator. Get personalized calories, protein, and fat targets with meal examples and electrolyte guidance. No email required.">
    <meta name="keywords" content="carnivore calculator, macro calculator, carnivore diet macros, keto calculator, protein calculator, free diet calculator">
    <meta name="author" content="Carnivore Weekly">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://carnivoreweekly.com/calculator.html">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://carnivoreweekly.com/calculator.html">
    <meta property="og:title" content="Free Carnivore Macro Calculator | Carnivore Weekly">
    <meta property="og:description" content="Calculate your personalized carnivore macros. Free, private, no email required. Includes meal examples and electrolyte guidance.">
    <meta property="og:image" content="https://carnivoreweekly.com/images/logo.png">
    <meta property="og:site_name" content="Carnivore Weekly">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://carnivoreweekly.com/calculator.html">
    <meta name="twitter:title" content="Free Carnivore Macro Calculator | Carnivore Weekly">
    <meta name="twitter:description" content="Calculate your personalized carnivore macros. Free, private, no email required.">
    <meta name="twitter:image" content="https://carnivoreweekly.com/images/logo.png">

    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">

    <title>Free Carnivore Macro Calculator | Carnivore Weekly</title>

    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NR4JVKW2JV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-NR4JVKW2JV');

        function trackCalculation(dietType, goal) {
            gtag('event', 'calculate', {
                'event_category': 'Calculator',
                'event_label': dietType + ' - ' + goal
            });
        }

        function trackUpgradeClick() {
            gtag('event', 'click', {
                'event_category': 'Upgrade',
                'event_label': 'AI Upgrade CTA'
            });
        }

        function trackAffiliateClick(product, link) {
            gtag('event', 'click', {
                'event_category': 'Affiliate',
                'event_label': product,
                'value': link
            });
        }
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Page-specific styles */
        .container {
            max-width: 1200px;
        }

        /* FREE Star Badge */
        .free-badge {
            position: absolute;
            top: -25px;
            right: 30px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
            color: #1a120b;
            padding: 20px 30px;
            border-radius: 50%;
            border: 4px solid #d4a574;
            box-shadow:
                0 8px 25px rgba(255, 215, 0, 0.6),
                0 4px 15px rgba(0, 0, 0, 0.4),
                inset 0 2px 0 rgba(255, 255, 255, 0.5);
            font-family: 'Playfair Display', serif;
            font-size: 1.1em;
            font-weight: 900;
            z-index: 10;
            text-align: center;
            line-height: 1.3;
            transform: rotate(-15deg);
            min-width: 120px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        }

        .free-badge::before {
            content: "‚òÖ";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2em;
            color: #ffd700;
            text-shadow:
                0 0 10px rgba(255, 215, 0, 0.8),
                2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .free-badge .big {
            font-size: 2em;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .free-badge .small {
            font-size: 0.7em;
            font-weight: 700;
            font-family: 'Merriweather', serif;
            opacity: 0.9;
        }

        @media (max-width: 768px) {
            .free-badge {
                position: static;
                display: inline-flex;
                margin: 0 auto 20px;
                transform: rotate(-8deg);
            }
        }

        /* Introduction Section */
        .intro-section {
            background: rgba(255, 255, 255, 0.92);
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
            border-left: 5px solid #d4a574;
            position: relative;
            z-index: 1;
        }

        .intro-section p {
            font-size: 1.05em;
            line-height: 1.8;
            color: #2c1810;
            margin-bottom: 18px;
        }

        .intro-section strong {
            color: #8b4513;
            font-weight: 700;
        }

        .intro-section em {
            color: #d4a574;
            font-style: italic;
        }

        /* Image beside text (reusable pattern) */
        .image-aside {
            float: right;
            margin: 0 0 25px 30px;
            max-width: 560px;
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        /* Keep intro-image as alias for backwards compatibility */
        .intro-image {
            float: right;
            margin: 0 0 25px 30px;
            max-width: 560px;
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        @media (max-width: 768px) {
            .intro-section {
                padding: 25px;
                margin-bottom: 30px;
            }

            .intro-section p {
                font-size: 1em;
            }

            .image-aside,
            .intro-image {
                float: none;
                margin: 0 0 20px 0;
                max-width: 100%;
            }
        }

        /* Card sections */
        .card {
            background: linear-gradient(135deg, #d4a574 0%, #c49a6c 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow:
                0 8px 25px rgba(0,0,0,0.5),
                inset 0 1px 0 rgba(255,255,255,0.3),
                inset 0 -1px 0 rgba(0,0,0,0.3);
            border: 3px solid #8b4513;
            position: relative;
        }

        .card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200"><filter id="noise2"><feTurbulence baseFrequency="0.6" numOctaves="3"/></filter><rect width="100%" height="100%" filter="url(%23noise2)" opacity="0.15"/></svg>');
            border-radius: 15px;
            pointer-events: none;
        }

        .card h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.2em;
            margin-bottom: 20px;
            color: #2c1810;
            border-bottom: 3px solid #8b4513;
            padding-bottom: 10px;
            text-shadow: 1px 1px 0 rgba(255,255,255,0.3);
            position: relative;
            z-index: 1;
        }

        /* Grid layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            position: relative;
            z-index: 1;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            position: relative;
            z-index: 1;
        }

        @media (max-width: 768px) {
            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        /* Form elements */
        label {
            display: block;
            font-weight: 700;
            margin-bottom: 8px;
            color: #2c1810;
            font-size: 0.95em;
        }

        input, select {
            width: 100%;
            padding: 16px 15px;
            border-radius: 8px;
            border: 2px solid #8b4513;
            background: rgba(255,255,255,0.9);
            color: #2c1810;
            font-family: 'Merriweather', serif;
            font-size: 1em;
            transition: all 0.3s;
            min-height: 48px;
        }

        input:focus, select:focus {
            outline: 3px solid #d4a574;
            outline-offset: 2px;
            border-color: #8b4513;
            background: #fff;
            box-shadow: 0 0 10px rgba(212, 165, 116, 0.5);
        }

        .input-hint {
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: 5px;
            font-style: italic;
            color: #666;
        }

        /* Error messages */
        .error-text {
            display: none;
            font-size: 0.9em;
            color: #8b4513;
            margin-top: 5px;
            padding: 8px 12px;
            background: rgba(139, 69, 19, 0.1);
            border-left: 3px solid #8b4513;
            border-radius: 4px;
        }

        /* Form Section Cards - "Breathing Room" */
        .form-section-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            position: relative;
            z-index: 1;
        }

        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 20px;
            border-bottom: 1px solid #f3f4f6;
            padding-bottom: 12px;
            font-family: 'Playfair Display', serif;
        }

        /* Enhanced input styling */
        input[type="text"],
        input[type="email"],
        input[type="number"],
        input[type="tel"],
        select {
            padding: 12px 16px !important;
            border: 1px solid #d1d5db !important;
            border-radius: 8px !important;
            font-size: 16px !important;
            background-color: #f9fafb !important;
            transition: all 0.2s !important;
            height: 44px !important;
            line-height: 20px !important;
        }

        textarea {
            padding: 12px 16px !important;
            border: 1px solid #d1d5db !important;
            border-radius: 8px !important;
            font-size: 16px !important;
            background-color: #f9fafb !important;
            transition: all 0.2s !important;
            min-height: 120px !important;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus,
        input[type="tel"]:focus,
        select:focus,
        textarea:focus {
            outline: none !important;
            border-color: #8b4513 !important;
            background-color: #fff !important;
            box-shadow: 0 0 0 4px rgba(139, 69, 19, 0.1) !important;
        }

        /* Upsell Container */
        .upsell-container {
            border: 2px solid #b91c1c;
            background: #fff1f2;
            padding: 40px;
            border-radius: 12px;
            margin-top: 50px;
            position: relative;
            z-index: 1;
        }

        .upsell-container h2 {
            color: #991b1b;
            margin-top: 0;
            margin-bottom: 30px;
            font-family: 'Playfair Display', serif;
            font-size: 2em;
        }

        .upsell-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }

        .feature-list {
            list-style: none;
            padding: 0;
        }

        .feature-list li {
            padding: 12px 0;
            font-size: 1.05em;
            color: #2c1810;
            border-bottom: 1px solid #fecaca;
        }

        .feature-list li:last-child {
            border-bottom: none;
        }

        .feature-list strong {
            color: #991b1b;
            font-weight: 700;
        }

        .price-box {
            text-align: center;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            border: 1px solid #fecaca;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 100%;
        }

        .price-original {
            text-decoration: line-through;
            color: #6b7280;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .price-final {
            font-size: 2.5rem;
            font-weight: bold;
            color: #b91c1c;
            margin-bottom: 20px;
            font-family: 'Playfair Display', serif;
        }

        .cta-button-pulse {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1.05em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Merriweather', serif;
            box-shadow: 0 4px 6px rgba(185, 28, 28, 0.3);
        }

        .cta-button-pulse:hover {
            background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 12px rgba(185, 28, 28, 0.4);
        }

        /* Mobile optimizations for 375px viewports */
        @media (max-width: 600px) {
            .free-badge {
                position: static;
                margin: 0 auto 15px;
                transform: rotate(-8deg);
                min-width: 100px;
                min-height: 100px;
            }

            .intro-section {
                padding: 20px;
                margin-bottom: 20px;
            }

            .intro-section p {
                font-size: 1em;
                line-height: 1.6;
            }

            .image-aside,
            .intro-image {
                float: none;
                margin: 0 0 15px 0;
                max-width: 100%;
            }

            .card {
                padding: 20px;
                margin-bottom: 20px;
            }

            .card h2 {
                font-size: 1.4em;
                margin-bottom: 15px;
            }

            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }

            .unit-toggle {
                width: 100%;
            }

            input, select, textarea {
                font-size: 16px !important;
            }

            .btn-group {
                flex-direction: column;
                gap: 10px;
            }

            button {
                width: 100%;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }

            .upsell-container {
                padding: 20px;
                margin-top: 30px;
            }

            .upsell-grid {
                grid-template-columns: 1fr;
            }

            .price-box {
                padding: 20px;
            }

            .price-final {
                font-size: 2em;
            }
        }

        @media (max-width: 768px) {
            .upsell-grid {
                grid-template-columns: 1fr;
            }

            .upsell-container {
                padding: 25px;
            }

            .form-section-card {
                padding: 20px;
            }
        }

        .error-text.show {
            display: block;
        }

        input[aria-invalid="true"],
        select[aria-invalid="true"] {
            border-color: #8b4513;
            border-width: 3px;
            background: rgba(139, 69, 19, 0.05);
        }

        /* Unit toggle */
        .unit-toggle {
            display: flex;
            gap: 0;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #8b4513;
            width: fit-content;
        }

        .unit-toggle button {
            padding: 10px 20px;
            border: none;
            background: rgba(255,255,255,0.7);
            color: #2c1810;
            cursor: pointer;
            font-family: 'Merriweather', serif;
            font-weight: 700;
            transition: all 0.3s;
        }

        .unit-toggle button.active {
            background: #8b4513;
            color: #f4e4d4;
        }

        .unit-toggle button:hover:not(.active) {
            background: rgba(255,255,255,0.9);
        }

        /* Buttons */
        button {
            cursor: pointer;
            padding: 14px 28px;
            border-radius: 10px;
            border: 2px solid #8b4513;
            background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%);
            color: #f4e4d4;
            font-weight: 700;
            font-family: 'Merriweather', serif;
            font-size: 1em;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.4);
        }

        button.primary {
            background: linear-gradient(135deg, #2a5f2a 0%, #3a7f3a 100%);
            border-color: #4a9f4a;
            font-size: 1.1em;
        }

        button.secondary {
            background: rgba(255,255,255,0.9);
            color: #2c1810;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        /* Results display */
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            position: relative;
            z-index: 1;
        }

        .result-box {
            background: rgba(255,255,255,0.6);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .result-label {
            font-size: 0.9em;
            font-weight: 700;
            color: #2c1810;
            margin-bottom: 8px;
            opacity: 0.8;
        }

        .result-value {
            font-family: 'Playfair Display', serif;
            font-size: 2em;
            font-weight: 900;
            color: #8b4513;
        }

        .result-unit {
            font-size: 0.7em;
            opacity: 0.7;
        }

        /* Warnings and info boxes */
        .warning {
            background: rgba(255, 140, 0, 0.2);
            border-left: 4px solid #ff8c00;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        .success {
            background: rgba(144, 238, 144, 0.2);
            border-left: 4px solid #90ee90;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        .info {
            background: rgba(255,255,255,0.5);
            border-left: 4px solid #8b4513;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            position: relative;
            z-index: 1;
        }

        /* Meal examples */
        .meal-example {
            background: rgba(255,255,255,0.7);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #8b4513;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .meal-example h4 {
            font-family: 'Playfair Display', serif;
            font-size: 1.3em;
            margin-bottom: 10px;
            color: #8b4513;
        }

        .meal-example ul {
            list-style: none;
            padding-left: 0;
        }

        .meal-example li {
            padding: 5px 0;
            padding-left: 25px;
            position: relative;
        }

        .meal-example li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 10px;
            color: #8b4513;
            font-weight: bold;
        }

        /* Timeline */
        .timeline-week {
            background: rgba(255,255,255,0.6);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #8b4513;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        .timeline-week h4 {
            font-family: 'Playfair Display', serif;
            color: #8b4513;
            margin-bottom: 8px;
        }

        /* Upgrade CTA */

        /* Hide/show elements */
        .hidden {
            display: none;
        }

        /* Disclaimer */
        .disclaimer {
            background: rgba(139, 69, 19, 0.2);
            border: 2px solid #8b4513;
            border-radius: 10px;
            padding: 20px;
            margin: 30px 0;
            font-size: 0.9em;
            position: relative;
            z-index: 1;
        }

        .disclaimer h3 {
            font-family: 'Playfair Display', serif;
            color: #8b4513;
            margin-bottom: 10px;
        }

        /* Print styles */
        @media print {
            /* Hide non-essential elements */
            body::before { display: none; }
            header { display: none !important; }
            footer { display: none !important; }
            nav { display: none !important; }
            .calculator-form { display: none !important; }
            #upgradeSection { display: none !important; }
            .free-badge { display: none !important; }

            /* Clean background for print */
            body {
                background: white;
                color: #000;
            }

            /* Show results section */
            #resultsSection {
                display: block !important;
                margin: 0;
                padding: 20px;
            }

            /* Print header with logo and branding */
            #resultsSection::before {
                content: '';
                display: block;
                width: 100%;
                padding: 30px 0;
                border-bottom: 3px solid #8b4513;
                margin-bottom: 30px;
                background:
                    linear-gradient(to right, transparent 0%, #d4a574 50%, transparent 100%)
                    no-repeat center bottom / 60% 2px;
            }

            /* Add logo and title at top */
            .container::before {
                content: 'CARNIVORE WEEKLY';
                display: block;
                font-family: 'Playfair Display', serif;
                font-size: 2em;
                font-weight: 900;
                text-align: center;
                color: #8b4513;
                margin-bottom: 5px;
                letter-spacing: 2px;
            }

            .container::after {
                content: 'Your Personalized Macro Plan';
                display: block;
                font-family: 'Merriweather', serif;
                font-size: 1em;
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                padding-bottom: 20px;
                border-bottom: 2px solid #d4a574;
            }

            /* Clean card styling for print */
            .card {
                background: white;
                border: 2px solid #8b4513;
                box-shadow: none;
                page-break-inside: avoid;
                margin-bottom: 20px;
            }

            .card h3 {
                color: #8b4513;
                border-bottom: 2px solid #d4a574;
                padding-bottom: 10px;
            }

            /* Ensure readability */
            .macro-split {
                border: 1px solid #ddd;
            }

            .warning, .info {
                background: white;
                border: 2px solid #666;
                color: #000;
            }

            .meal-example {
                background: white;
                border: 2px solid #8b4513;
            }

            /* Footer note on print */
            #resultsSection::after {
                content: 'Generated at carnivoreweekly.com/calculator.html';
                display: block;
                margin-top: 40px;
                padding-top: 20px;
                border-top: 1px solid #ddd;
                text-align: center;
                font-size: 0.85em;
                color: #666;
            }

            /* Page breaks */
            .card { page-break-inside: avoid; }
            h3 { page-break-after: avoid; }
        }

        /* Center header subtitle */
        header p {
            text-align: center;
        }

        /* ========================================
           PATH CHOICE SYSTEM
           ======================================== */

        .path-choice-container {
            background: linear-gradient(135deg, #faf8f3 0%, #f5f2ed 100%);
            border: 3px solid #8b4513;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .choice-header {
            font-family: 'Playfair Display', serif;
            font-size: 2.5em;
            color: #8b4513;
            text-align: center;
            margin-bottom: 30px;
        }

        .choice-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 25px;
        }

        .choice-card {
            background: white;
            border: 3px solid #d4a574;
            border-radius: 12px;
            padding: 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            min-height: 400px;
            transition: all 0.3s;
        }

        .choice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .choice-badge {
            position: absolute;
            top: -15px;
            right: 20px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9em;
        }

        .choice-badge--paid {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a120b;
            font-size: 1.1em;
        }

        .choice-card h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            color: #2c1810;
            margin: 10px 0 20px 0;
        }

        .choice-features {
            list-style: none;
            padding: 0;
            margin: 0 0 20px 0;
            flex: 1;
        }

        .choice-features li {
            padding: 10px 0 10px 30px;
            position: relative;
            border-bottom: 1px solid rgba(212, 165, 116, 0.2);
            font-size: 1.05em;
            color: #2c1810;
        }

        .choice-features li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #4caf50;
            font-weight: bold;
            font-size: 1.3em;
        }

        .choice-features li:last-child {
            border-bottom: none;
        }

        .choice-time {
            text-align: center;
            color: #666;
            font-size: 0.95em;
            font-style: italic;
            margin: 15px 0;
        }

        .choice-btn {
            padding: 16px 32px;
            border: none;
            border-radius: 10px;
            font-family: 'Merriweather', serif;
            font-size: 1.1em;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            width: 100%;
        }

        .choice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .choice-btn--free {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
        }

        .choice-btn--free:hover {
            background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
        }

        .choice-btn--paid {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #1a120b;
            border: 3px solid #d4a574;
        }

        .choice-btn--paid:hover {
            background: linear-gradient(135deg, #ffed4e 0%, #ffd700 100%);
        }

        .choice-note {
            text-align: center;
            color: #666;
            font-size: 0.95em;
            font-style: italic;
            margin: 0;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .choice-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .path-choice-container {
                padding: 25px 20px;
            }

            .choice-header {
                font-size: 1.8em;
            }

            .choice-card {
                padding: 25px;
                min-height: 350px;
            }

            .choice-card h3 {
                font-size: 1.5em;
            }
        }

        @media (max-width: 600px) {
            .path-choice-container {
                padding: 20px 15px;
                margin-bottom: 25px;
            }

            .choice-header {
                font-size: 1.5em;
                margin-bottom: 20px;
            }

            .choice-card {
                padding: 20px;
                min-height: 320px;
            }

            .choice-features li {
                font-size: 0.95em;
                padding: 8px 0 8px 25px;
            }
        }

        /* ========================================
           ADVANCED FORM SECTIONS STYLING
           ======================================== */

        .form-section {
            background: linear-gradient(135deg, #faf8f3 0%, #f5f2ed 100%);
            border: 3px solid #8b4513;
            border-radius: 12px;
            padding: 35px;
            margin-bottom: 25px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        .form-section h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1.8em;
            color: #8b4513;
            margin-bottom: 10px;
            margin-top: 0;
        }

        .form-section .subtitle {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 25px;
            margin-top: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #2c1810;
            font-family: 'Merriweather', serif;
        }

        /* Override generic input styles for advanced form sections */
        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="number"],
        .form-group input[type="tel"],
        .form-group select {
            width: 100% !important;
            padding: 12px !important;
            border: 2px solid #d4a574 !important;
            border-radius: 8px !important;
            font-family: 'Merriweather', serif !important;
            font-size: 1em !important;
            box-sizing: border-box !important;
            background-color: white !important;
            color: #2c1810 !important;
            height: auto !important;
            line-height: 1.5 !important;
        }

        .form-group textarea {
            width: 100% !important;
            padding: 12px !important;
            border: 2px solid #d4a574 !important;
            border-radius: 8px !important;
            font-family: 'Merriweather', serif !important;
            font-size: 1em !important;
            box-sizing: border-box !important;
            background-color: white !important;
            color: #2c1810 !important;
            min-height: 100px !important;
            resize: vertical;
        }

        .form-group input[type="text"]:focus,
        .form-group input[type="email"]:focus,
        .form-group input[type="number"]:focus,
        .form-group input[type="tel"]:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none !important;
            border-color: #8b4513 !important;
            box-shadow: 0 0 0 3px rgba(139, 69, 19, 0.1) !important;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px !important;
            height: 20px !important;
            margin-right: 10px !important;
            margin-top: 2px !important;
            cursor: pointer;
            flex-shrink: 0;
            border: 2px solid #d4a574 !important;
            border-radius: 4px !important;
            background-color: white !important;
        }

        .checkbox-item label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
            font-size: 0.95em;
            font-family: 'Merriweather', serif;
            color: #2c1810;
        }

        .optional {
            font-weight: normal;
            font-size: 0.85em;
            color: #999;
        }

        /* Mobile responsiveness for form sections */
        @media (max-width: 768px) {
            .form-section {
                padding: 25px;
                margin-bottom: 20px;
            }

            .form-section h3 {
                font-size: 1.5em;
                margin-bottom: 10px;
            }

            .form-section .subtitle {
                font-size: 0.9em;
                margin-bottom: 20px;
            }

            .checkbox-group {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .form-group input[type="text"],
            .form-group input[type="email"],
            .form-group input[type="number"],
            .form-group input[type="tel"],
            .form-group select,
            .form-group textarea {
                padding: 10px !important;
                font-size: 16px !important;
            }
        }
    </style>

    <!-- Schema.org WebApplication markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Carnivore Diet Macro Calculator",
      "description": "Free carnivore diet macro calculator - calculate personalized protein, fat, and calorie targets",
      "url": "https://carnivoreweekly.com/calculator.html",
      "applicationCategory": "HealthApplication",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      },
      "featureList": [
        "Personalized macro calculation",
        "Imperial/Metric conversion",
        "Activity level adjustment",
        "Diet-specific recommendations",
        "Meal examples"
      ]
    }
    </script>
</head>
<body>
    <header>
        <div class="container">
            <img src="images/logo.png" alt="Carnivore Weekly Logo" class="logo">
            <h1>CALCULATOR</h1>
            <p class="subtitle">Macro Calculator</p>
        </div>
    </header>

    <!-- Navigation Menu -->
    <nav class="nav-menu" id="top-nav">
        <a href="index.html">Home</a>
        <a href="archive.html">Archive</a>
        <a href="channels.html">Channels</a>
        <a href="calculator.html" class="active">Calculator</a>
        <a href="wiki.html">Wiki</a>
        <a href="blog.html">Blog</a>
        <a href="about.html">About</a>
    </nav>

    <!-- Fixed Side Feedback Button -->
    <a href="https://forms.gle/RTzpnv4PvaP1TEZt7" target="_blank" rel="noopener noreferrer" class="feedback-btn feedback-side feedback-btn-small">
        üí¨ Feedback
    </a>

    <main>
        <div class="container">
            <!-- Introduction Section -->
            <section class="intro-section">
                <p>I made this calculator because I kept getting <strong>pissed off</strong>.</p>

                <p>You know how it goes. You're trying to figure out your macros, so you Google "carnivore diet calculator" or whatever. You find one that looks decent. Start filling it out. Age, weight, activity level... getting into it. Then BAM ‚Äì paywall. Or worse, "Thanks! We'll email you the results!"</p>

                <p>Yeah, no. I'm not giving you my email so you can spam me about your coaching program.</p>

                <p>So here's what I built:</p>

                <img src="shopping-cart.png" alt="Shopping cart filled with carnivore foods including meat, butter, and eggs" class="intro-image">

                <p><strong>The free calculator</strong> gives you what you actually came for. Your daily macro targets. No email required, no games. If that's all you need, you're done in 2 minutes.</p>

                <p>If you want the full protocol, there's a <strong>$9.99 version</strong>.</p>

                <p>You answer 15 more questions about your situation (health conditions, goals, food preferences). Then you get 5 AI-generated reports:</p>

                <ul style="margin-left: 25px; margin-bottom: 20px; line-height: 1.8;">
                    <li><strong>Executive Summary</strong> - Your complete protocol in 2 pages</li>
                    <li><strong>Food Pyramid &amp; Guidelines</strong> - What to eat, what to avoid, portions</li>
                    <li><strong>Week 1 Meal Plan</strong> - Exact meals matched to your macros</li>
                    <li><strong>30-Day Meal Calendar</strong> - Full month roadmap</li>
                    <li><strong>Shopping Lists</strong> - What to buy, how much, estimated costs</li>
                </ul>

                <p>Everything downloads as a printable PDF. No ongoing subscription. One payment, yours forever.</p>

                <p><strong>Early access pricing:</strong> This is $9.99 now. Going to $19.99 on January 31, 2026 when I add the recipe database and video walkthroughs. Lock in $9.99 today, pay once, keep access forever even after the price goes up.</p>

                <p><strong>Your data:</strong> Your report sticks around for 48 hours so you can download it. After that, it's gone. I'm not storing your data long-term, and I'm not building a profile on you. You get what you paid for, you save it if you want it, and then it disappears.</p>

                <div style="background: rgba(212, 165, 116, 0.1); border-left: 4px solid #d4a574; padding: 20px; margin: 25px 0; border-radius: 8px;">
                    <p style="margin: 0 0 15px 0; font-size: 1.1em;"><strong>Two options:</strong></p>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                        <div>
                            <p style="margin: 0;"><strong>Free Calculator</strong><br>
                            Macros in 2 minutes. No email. Scroll down.</p>
                        </div>
                        <div>
                            <p style="margin: 0;"><strong>Full Protocol ($9.99)</strong><br>
                            Macros + 5 reports + meal plans + shopping lists.</p>
                            <a href="https://buy.stripe.com/dRm3cv7OHalA8FM092ao801" onclick="gtag('event', 'upgrade_click', {'event_category': 'conversion', 'event_label': 'intro_cta'});" style="display: inline-block; margin-top: 10px; background: linear-gradient(135deg, #8b4513 0%, #a0522d 100%); color: #f4e4d4; padding: 10px 20px; border-radius: 8px; text-decoration: none; font-weight: 700;">
                                Get Complete Protocol ‚Üí
                            </a>
                        </div>
                    </div>

                    <p style="margin: 0; font-size: 0.95em; opacity: 0.9;">No email harvesting. No bait and switch. No bullshit.</p>
                </div>

                <p style="margin-top: 25px; font-size: 1.15em;"><strong>Choose your path below.</strong></p>
            </section>

            <!-- PATH CHOICE SCREEN -->
            <div id="pathChoice" class="path-choice-container">
                <h2 class="choice-header">Choose Your Path</h2>

                <div class="choice-grid">
                    <div class="choice-card choice-card--free">
                        <div class="choice-badge">FREE</div>
                        <h3>Quick Macro Calculator</h3>
                        <ul class="choice-features">
                            <li>Daily calorie & macro targets</li>
                            <li>2-meal day examples</li>
                            <li>Electrolyte guidance</li>
                            <li>Instant results</li>
                        </ul>
                        <p class="choice-time">‚è±Ô∏è 2 minutes</p>
                        <button class="choice-btn choice-btn--free" onclick="choosePath('free')">
                            Start Free Calculator ‚Üí
                        </button>
                    </div>

                    <div class="choice-card choice-card--paid">
                        <div class="choice-badge choice-badge--paid">$9.99</div>
                        <h3>Complete 30-Day Protocol</h3>
                        <ul class="choice-features">
                            <li>Everything in Free Calculator</li>
                            <li>30-day personalized meal plan</li>
                            <li>Weekly shopping lists</li>
                            <li>Doctor consultation script</li>
                            <li>48-hour report access via email</li>
                        </ul>
                        <p class="choice-time">‚è±Ô∏è 5 minutes + payment</p>
                        <button class="choice-btn choice-btn--paid" onclick="choosePath('paid')">
                            Get Full Protocol ‚Üí
                        </button>
                    </div>
                </div>

                <p class="choice-note">Both paths are valid. Pick what fits your needs today.</p>
            </div>

            <!-- Calculator Card -->
            <div class="card hidden" id="calculatorForm" style="position: relative;">
                <!-- FREE Star Badge -->
                <div class="free-badge">
                    <div class="big">FREE!</div>
                    <div class="small">No email required</div>
                </div>

                <h2>Calculate Your Macros</h2>

                <!-- Unit Toggle -->
                <div class="unit-toggle">
                    <button id="imperialBtn" class="active" onclick="setUnits('imperial')">Imperial (lbs/in)</button>
                    <button id="metricBtn" onclick="setUnits('metric')">Metric (kg/cm)</button>
                </div>

                <!-- Input Form -->
                <div class="grid-2">
                    <div>
                        <label for="sex">Sex</label>
                        <select id="sex">
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                    <div>
                        <label for="age">Age</label>
                        <input type="number" id="age" min="14" max="99" value="35" inputmode="numeric" autocomplete="off">
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label>Height <span id="heightUnit">(feet & inches)</span></label>
                        <div id="imperialHeight" style="display: flex; gap: 10px;">
                            <div style="flex: 1;">
                                <input type="number" id="heightFeet" min="3" max="8" value="5" inputmode="numeric" autocomplete="off" aria-label="Feet">
                            </div>
                            <div style="flex: 1;">
                                <input type="number" id="heightInches" min="0" max="11" value="10" inputmode="numeric" autocomplete="off" aria-label="Inches">
                            </div>
                        </div>
                        <input type="number" id="heightCm" min="120" max="230" value="178" step="1" class="hidden" inputmode="numeric" autocomplete="off">
                        <p class="input-hint" id="height-hint">Example: 5 feet 10 inches</p>
                    </div>
                    <div>
                        <label for="weight">Weight <span id="weightUnit">(lbs)</span></label>
                        <input type="number" id="weight" value="180" step="0.1" inputmode="decimal" autocomplete="off">
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="lifestyle">Daily Lifestyle</label>
                        <select id="lifestyle" onchange="updateActivityDisplay()" aria-describedby="lifestyle-hint">
                            <option value="1.2" selected>Desk job, minimal walking</option>
                            <option value="1.3">Desk job, walk 30-60 min/day</option>
                            <option value="1.4">Standing job (retail, teaching)</option>
                            <option value="1.5">Active job (server, nurse, on feet all day)</option>
                            <option value="1.6">Physical labor (construction, farming)</option>
                        </select>
                        <p class="input-hint" id="lifestyle-hint">Your occupation, not gym time</p>
                    </div>
                    <div>
                        <label for="exercise">Structured Exercise</label>
                        <select id="exercise" onchange="updateActivityDisplay()" aria-describedby="exercise-hint">
                            <option value="0">None</option>
                            <option value="0.1">1-2x/week, light (walking, yoga)</option>
                            <option value="0.2">3-4x/week, moderate (lifting, jogging)</option>
                            <option value="0.3" selected>4-5x/week, intense (CrossFit, HIIT)</option>
                            <option value="0.4">6-7x/week, athlete (serious training)</option>
                        </select>
                        <p class="input-hint" id="exercise-hint">Gym sessions only, not daily movement</p>
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="goal">Goal</label>
                        <select id="goal" onchange="updateDeficitLabel()">
                            <option value="lose" selected>Lose Fat</option>
                            <option value="maintain">Maintain Weight</option>
                            <option value="gain">Gain Muscle</option>
                        </select>
                    </div>
                    <div style="display: flex; align-items: center; justify-content: center; padding: 10px; background: rgba(212, 165, 116, 0.1); border-radius: 8px; border: 1px solid rgba(212, 165, 116, 0.3);">
                        <p style="margin: 0; font-size: 0.9em; color: #d4a574; text-align: center;">
                            <strong>Total Activity:</strong> <span id="activityDisplay">1.5x BMR</span>
                        </p>
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <label for="deficit" id="deficitLabel">Calorie Deficit (%)</label>
                        <input type="number" id="deficit" min="0" max="40" value="0" step="5" inputmode="numeric" autocomplete="off" aria-describedby="deficit-hint">
                        <p class="input-hint" id="deficit-hint">15-25% is sustainable for most people</p>
                    </div>
                    <div>
                        <label for="diet">Diet Style</label>
                        <select id="diet" onchange="updateDietOptions()">
                            <option value="carnivore" selected>Carnivore (0-5g carbs)</option>
                            <option value="keto">Keto (~20g net carbs)</option>
                            <option value="lowcarb">Low-Carb (~75g net carbs)</option>
                        </select>
                    </div>
                </div>

                <!-- Carnivore-specific options -->
                <div id="carnivoreOptions">
                    <div class="grid-2">
                        <div>
                            <label for="ratio">Fat/Protein Ratio (by calories)</label>
                            <select id="ratio">
                                <option value="65-35">65% fat / 35% protein (leaner)</option>
                                <option value="70-30" selected>70% fat / 30% protein (standard)</option>
                                <option value="80-20">80% fat / 20% protein (therapeutic/satiety)</option>
                            </select>
                        </div>
                        <div>
                            <label for="proteinMin">Protein Minimum</label>
                            <select id="proteinMin">
                                <option value="1.6" selected>1.6 g/kg (0.7 g/lb) - Standard</option>
                                <option value="1.8">1.8 g/kg (0.8 g/lb) - Active</option>
                                <option value="2.2">2.2 g/kg (1.0 g/lb) - Athlete</option>
                            </select>
                            <p class="input-hint">Enforces minimum protein to prevent muscle loss</p>
                        </div>
                    </div>
                </div>

                <!-- Keto/Low-carb options -->
                <div id="ketoOptions" class="hidden">
                    <div class="grid-2">
                        <div>
                            <label for="netCarbs">Net Carbs (g/day)</label>
                            <input type="number" id="netCarbs" min="0" max="150" value="20">
                        </div>
                        <div>
                            <label for="proteinSetting">Protein Target</label>
                            <select id="proteinSetting">
                                <option value="1.6" selected>1.6 g/kg (0.7 g/lb) - Standard</option>
                                <option value="1.8">1.8 g/kg (0.8 g/lb) - Active</option>
                                <option value="2.2">2.2 g/kg (1.0 g/lb) - Athlete</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ADVANCED SECTIONS (hidden by default for progressive disclosure) -->
                <div id="advancedSections" class="hidden">

                    <!-- SECTION 1: CONTACT INFORMATION -->
                    <div class="form-section">
                        <h3>üìß Your Information</h3>
                        <p class="subtitle">Where should we send your complete protocol?</p>

                        <div class="form-group">
                            <label>Email Address <span class="optional">(required)</span></label>
                            <input type="email" name="email" id="email" placeholder="your@email.com" autocomplete="email">
                        </div>

                        <div class="form-group">
                            <label>First Name <span class="optional">(optional)</span></label>
                            <input type="text" name="firstName" placeholder="e.g., John" autocomplete="given-name">
                        </div>
                    </div>

                    <!-- SECTION 2: HEALTH CONDITIONS -->
                    <div class="form-section">
                        <h3>üè• Current Health Conditions</h3>
                        <p class="subtitle">Help us tailor the protocol to your situation (all optional)</p>

                        <div class="form-group">
                            <label>Current Medications <span class="optional">(optional)</span></label>
                            <textarea name="medications" placeholder="e.g., Metformin for diabetes, levothyroxine for thyroid..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Existing Health Conditions <span class="optional">(optional)</span></label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="diabetes" name="conditions" value="diabetes">
                                    <label for="diabetes">Type 2 Diabetes / Pre-diabetes</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="thyroid" name="conditions" value="thyroid">
                                    <label for="thyroid">Thyroid Issues (Hashimoto's, hypothyroid)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="autoimmune" name="conditions" value="autoimmune">
                                    <label for="autoimmune">Autoimmune Condition</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="gut" name="conditions" value="gut">
                                    <label for="gut">Digestive Issues (IBS, Crohn's, colitis)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="heart" name="conditions" value="heart">
                                    <label for="heart">Heart/Cardiovascular Condition</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="weight" name="conditions" value="weight">
                                    <label for="weight">Significant Weight Issues</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- SECTION 3: ALLERGIES & RESTRICTIONS -->
                    <div class="form-section">
                        <h3>üö´ Allergies & Food Restrictions</h3>
                        <p class="subtitle">Help us avoid foods you can't or won't eat</p>

                        <div class="form-group">
                            <label>Food Allergies <span class="optional">(optional)</span></label>
                            <textarea name="allergies" placeholder="e.g., Shellfish allergy, lactose intolerant, egg allergy"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Foods You Can't/Won't Eat <span class="optional">(optional)</span></label>
                            <textarea name="avoidFoods" placeholder="e.g., Don't like fish, can't digest dairy, won't eat organ meat"></textarea>
                        </div>
                    </div>

                    <!-- SECTION 4: DIET HISTORY -->
                    <div class="form-section">
                        <h3>üçΩÔ∏è Diet History</h3>
                        <p class="subtitle">What diets have you tried before?</p>

                        <div class="form-group">
                            <label>Previous Diets Tried <span class="optional">(optional)</span></label>
                            <textarea name="previousDiets" placeholder="e.g., Keto for 6 months (lost weight but plateaued), vegan (felt terrible)..."></textarea>
                        </div>

                        <div class="form-group">
                            <label>Carnivore Experience <span class="optional">(optional)</span></label>
                            <select name="carnivoreExperience">
                                <option value="">Select one...</option>
                                <option value="never">Never tried carnivore</option>
                                <option value="dabbled">Tried it briefly (days/weeks)</option>
                                <option value="months">Did it for months</option>
                                <option value="current">Currently on carnivore</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Which Protocol Interests You? <span class="optional">(optional)</span></label>
                            <select name="selectedProtocol">
                                <option value="">Select one...</option>
                                <option value="carnivore">Carnivore (beef, poultry, fish, eggs, dairy)</option>
                                <option value="pescatarian">Pescatarian Carnivore (fish, eggs, dairy only)</option>
                                <option value="lion">Lion Diet (beef, salt, water only)</option>
                                <option value="keto">Keto (low-carb, includes some plants)</option>
                            </select>
                        </div>
                    </div>

                    <!-- SECTION 5: GOALS & PRIORITIES -->
                    <div class="form-section">
                        <h3>üéØ Your Goals & Priorities</h3>
                        <p class="subtitle">What matters most to you? (all optional)</p>

                        <div class="form-group">
                            <label>Primary Goals (select top 3) <span class="optional">(optional)</span></label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="weightloss" name="goals" value="weightloss">
                                    <label for="weightloss">Weight Loss</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="muscle" name="goals" value="muscle">
                                    <label for="muscle">Build Muscle</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="energy" name="goals" value="energy">
                                    <label for="energy">More Energy</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="mentalgoal" name="goals" value="mental">
                                    <label for="mentalgoal">Mental Clarity / Focus</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="guthealth" name="goals" value="guthealth">
                                    <label for="guthealth">Fix Gut Health</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="inflammation" name="goals" value="inflammation">
                                    <label for="inflammation">Reduce Inflammation</label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Anything Else We Should Know? <span class="optional">(optional)</span></label>
                            <textarea name="additionalNotes" placeholder="Any other preferences, constraints, or information that would help us personalize your protocol..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button id="calculateBtn" class="primary" onclick="handlePrimaryButton()">Calculate My Macros</button>
                    <button class="secondary" onclick="resetForm()">Reset</button>
                </div>

                <!-- Advanced form submit button (hidden by default) -->
                <div id="advancedSubmitSection" class="hidden" style="margin-top: 30px; text-align: center;">
                    <h2 style="margin-top: 0; color: #1a120b;">Ready to Get Your Protocol?</h2>
                    <p style="margin-bottom: 25px; color: #2c1810;">Click below to generate your personalized 30-day carnivore protocol.</p>
                    <button class="primary" onclick="submitAdvancedForm()">Generate My Complete Protocol</button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden">
                <div class="card">
                    <h2>Your Personalized Macros</h2>

                    <div class="results-grid">
                        <div class="result-box">
                            <div class="result-label">Daily Calories</div>
                            <div class="result-value" id="outCalories">‚Äî</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">TDEE (Maintenance)</div>
                            <div class="result-value" id="outTdee">‚Äî</div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Protein</div>
                            <div class="result-value"><span id="outProtein">‚Äî</span><span class="result-unit">g</span></div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Fat</div>
                            <div class="result-value"><span id="outFat">‚Äî</span><span class="result-unit">g</span></div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Net Carbs</div>
                            <div class="result-value"><span id="outCarbs">‚Äî</span><span class="result-unit">g</span></div>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Macro Split</div>
                            <div class="result-value" id="outSplit" style="font-size: 1.2em;">‚Äî</div>
                        </div>
                    </div>

                    <!-- ButcherBox Affiliate Ad -->
                    <div style="margin: 40px 0; text-align: center;">
                        <a href="https://butcherbox.pxf.io/Z6oVMR?utm_source=carnivore_weekly&utm_medium=affiliate&utm_campaign=calculator_results" target="_blank" rel="noopener" onclick="trackAffiliateClick('ButcherBox', 'https://butcherbox.pxf.io/Z6oVMR')">
                            <img src="butcherbox-ad.jpeg" alt="ButcherBox: Steaks Of Your Choice Free in Every Box For a Year" style="width: 100%; max-width: 600px; height: auto; display: inline-block; border-radius: 15px; box-shadow: 0 8px 25px rgba(0,0,0,0.5);">
                        </a>
                    </div>

                    <!-- Warnings/Success Messages -->
                    <div id="flagsContainer"></div>

                    <div class="btn-group no-print">
                        <button onclick="window.print()">üñ®Ô∏è Print Summary</button>
                        <button class="secondary" onclick="scrollToUpgrade()">See AI Upgrade</button>
                    </div>
                </div>

                <!-- What This Looks Like -->
                <div class="card" id="mealExamples">
                    <h2>What This Looks Like on Your Plate</h2>
                    <div id="mealExamplesContent">
                        <!-- Generated by JS -->
                    </div>
                </div>

                <!-- Electrolyte Guidance -->
                <div class="card">
                    <h2>Electrolyte Targets (Critical for Success)</h2>
                    <p class="info">Most carnivore beginners underestimate electrolytes. Getting these right prevents headaches, cramps, and fatigue.</p>

                    <div class="grid-3">
                        <div class="result-box">
                            <div class="result-label">Sodium</div>
                            <div class="result-value">5000<span class="result-unit">mg</span></div>
                            <p style="margin-top: 10px; font-size: 0.9em;">2-3 tsp salt per day</p>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Potassium</div>
                            <div class="result-value">3500<span class="result-unit">mg</span></div>
                            <p style="margin-top: 10px; font-size: 0.9em;">Beef, fish, avocado</p>
                        </div>
                        <div class="result-box">
                            <div class="result-label">Magnesium</div>
                            <div class="result-value">400<span class="result-unit">mg</span></div>
                            <p style="margin-top: 10px; font-size: 0.9em;">Supplement recommended</p>
                        </div>
                    </div>

                    <div class="info" style="margin-top: 20px;">
                        <strong>Easy wins:</strong> Salt your food generously, drink bone broth, eat fatty fish (salmon, sardines). If you get headaches or feel weak, add more salt first.
                    </div>

                    <!-- LMNT Affiliate -->
                    <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #ffd700 0%, #d4a574 100%); border-radius: 12px; border: 3px solid #8b4513;">
                        <h3 style="margin: 0 0 10px 0; color: #1a120b; font-family: 'Playfair Display', serif;">‚ö° The Easy Button for Electrolytes</h3>
                        <p style="margin: 0 0 15px 0; color: #2c1810; font-size: 1em; line-height: 1.6;">
                            <strong>LMNT</strong> is specifically formulated for low-carb diets. Zero sugar, optimal sodium ratio, tastes great. Used by athletes and carnivores worldwide.
                        </p>
                        <a href="http://elementallabs.refr.cc/default/u/michelbrew"
                           target="_blank"
                           rel="noopener noreferrer"
                           onclick="gtag('event', 'click', {'event_category': 'Affiliate', 'event_label': 'LMNT - Calculator', 'value': 'http://elementallabs.refr.cc/default/u/michelbrew'});"
                           style="display: inline-block; background: #1a120b; color: #ffd700; padding: 12px 30px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 1.1em; transition: all 0.3s;">
                            Try LMNT - Get Free Sample Pack ‚Üí
                        </a>
                        <p style="margin: 15px 0 0 0; font-size: 0.85em; color: #2c1810; opacity: 0.8;">
                            Affiliate link - Supports this free calculator
                        </p>
                    </div>
                </div>

                <!-- Adaptation Timeline -->
                <div class="card">
                    <h2>First 4 Weeks: What to Expect</h2>

                    <div class="timeline-week">
                        <h4>Week 1: The Suck</h4>
                        <p>Headaches, fatigue, possible diarrhea. This is normal. Your body is switching fuel sources. Double your salt intake. Rest more. Don't quit.</p>
                    </div>

                    <div class="timeline-week">
                        <h4>Week 2: Stabilizing</h4>
                        <p>Energy starts returning. Digestion regulating. Cravings for carbs peaking then fading. Hunger might spike - this is temporary. Stay the course.</p>
                    </div>

                    <div class="timeline-week">
                        <h4>Week 3: Momentum</h4>
                        <p>Mental clarity improving. Energy more stable. Body composition changes visible. You're fat-adapted now. Appetite naturally regulating.</p>
                    </div>

                    <div class="timeline-week">
                        <h4>Week 4: The Shift</h4>
                        <p>This feels sustainable. Hunger signals are clear. You eat when hungry, stop when full. Weight loss (if that's your goal) is consistent. You're dialed in.</p>
                    </div>

                    <div class="warning">
                        <strong>Common Mistake:</strong> Quitting during Week 1-2 because you feel terrible. That's adaptation, not failure. Give it 30 days minimum before judging results.
                    </div>
                </div>

                <!-- Common Mistakes -->
                <div class="card">
                    <h2>Common Mistakes (Avoid These)</h2>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Not Enough Salt</strong><br>
                        You need 2-3 teaspoons per day. If you get headaches, add salt first before assuming carnivore doesn't work for you.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Too Lean</strong><br>
                        Fat is your primary fuel. If you only eat chicken breast, you'll be hungry and miserable. Eat fatty cuts (ribeye, ground beef 80/20, salmon).
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Not Eating Enough</strong><br>
                        Especially in the first month, eat when hungry. Don't force a deficit while adapting. Your appetite will naturally regulate after you're fat-adapted.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Quitting Too Soon</strong><br>
                        Week 1-2 can feel rough. That's your body adapting, not failing. Give it 30 days minimum before deciding if this works for you.
                    </div>

                    <div class="warning">
                        <strong>‚ö†Ô∏è Overcomplicating It</strong><br>
                        You don't need fancy recipes. Steak. Eggs. Ground beef. Salt. That's it. Save the gourmet carnivore pizza experiments for month 3.
                    </div>
                </div>
            </div>

            <!-- AI Upgrade CTA -->
            <div id="upgradeSection" class="upsell-container no-print hidden">
                <h2>Get Your Complete Personalized 30-Day Protocol</h2>

                <div class="upsell-grid">
                    <!-- Features Column -->
                    <div>
                        <ul class="feature-list">
                            <li>‚úÖ <strong>30-Day Meal Plan</strong> - Matched to your exact macros & preferences</li>
                            <li>‚úÖ <strong>Weekly Grocery Lists</strong> - With portions & cost estimates</li>
                            <li>‚úÖ <strong>Doctor's Consultation Script</strong> - Labs to request, questions to ask</li>
                            <li>‚úÖ <strong>Stall-Breaker Decision Tree</strong> - What to check when progress stops</li>
                            <li>‚úÖ <strong>Research Guide</strong> - Studies explained in plain English</li>
                            <li>‚úÖ <strong>Printable PDF</strong> - All 13 reports, one organized document</li>
                        </ul>
                    </div>

                    <!-- Price Box Column -->
                    <div class="price-box">
                        <div>
                            <div class="price-original">$29.99</div>
                            <div class="price-final">$9.99</div>
                            <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">Limited time offer</p>
                        </div>
                        <button class="cta-button-pulse" onclick="upgradeFromFree()">Get My Plan Now</button>
                        <p style="font-size: 0.8em; color: #666; margin-top: 15px;">One-time payment<br>No subscription</p>
                    </div>
                </div>

                <!-- Privacy Note -->
                <div style="margin-top: 30px; padding: 15px; background: rgba(185, 28, 28, 0.05); border: 1px solid #fecaca; border-radius: 8px;">
                    <p style="font-size: 0.95em; margin: 0; color: #2c1810;">
                        üîí <strong>Your data is secure</strong><br>
                        <span style="font-size: 0.9em; opacity: 0.8; margin-top: 8px; display: block;">Download your PDF anytime. Automatically deleted after 48 hours. No email required.</span>
                    </p>
                </div>
            </div>

        </div>
    </main>

    <!-- Footer -->
    <footer style="background: linear-gradient(135deg, #4a2511 0%, #6d3819 50%, #8b4513 100%); color: #f4e4d4; padding: 40px 20px; text-align: center; margin-top: 60px; border-top: 4px solid #8b4513;">
        <div style="width: 100%; max-width: 1200px; margin: 0 auto;">
            <p style="font-family: 'Playfair Display', serif; font-size: 1.5em; font-weight: 700; margin-bottom: 10px;">CARNIVORE WEEKLY</p>
            <p style="opacity: 0.9;">The Finest Carnivore Content, Curated Weekly</p>
            <nav style="margin-top: 20px; opacity: 0.8;">
                <a href="index.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Home</a>
                <a href="channels.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Channels</a>
                <a href="wiki.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Wiki</a>
                <a href="calculator.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Calculator</a>
                <a href="about.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">About</a>
                <a href="archive.html" style="color: #d4a574; text-decoration: none; margin: 0 15px;">Archive</a>
            </nav>
            <p style="margin-top: 15px; font-size: 0.85em; opacity: 0.7;">
                <a href="privacy.html" style="color: #d4a574; text-decoration: none;">Privacy Policy</a>
            </p>

            <!-- Disclaimers -->
            <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid rgba(212, 165, 116, 0.3); max-width: 800px; margin-left: auto; margin-right: auto;">
                <p style="font-size: 0.85em; opacity: 0.7; margin-bottom: 15px; line-height: 1.6;">
                    <strong style="color: #d4a574;">Medical Disclaimer:</strong> This calculator provides estimates based on research-validated formulas. Results vary by individual. Always consult your healthcare provider before starting any new diet, especially if you have existing health conditions or take medications.
                </p>
                <p style="font-size: 0.85em; opacity: 0.7; margin-bottom: 15px; line-height: 1.6;">
                    <strong style="color: #d4a574;">Privacy First:</strong> All calculations happen in your browser. We don't store, track, or collect your personal data. Ever.
                </p>
                <p style="font-size: 0.75em; opacity: 0.6; line-height: 1.6;">
                    Macro calculations use the Mifflin-St Jeor equation (gold standard for BMR) and carnivore-specific ratios validated by peer-reviewed research. Your actual needs may differ based on genetics, metabolic health, and activity patterns.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // ---------- State ----------
        let currentUnits = 'imperial';
        let currentResults = null;

        // ---------- PATH CHOICE SYSTEM ----------
        async function choosePath(path) {
            try {
                // Store path choice immediately (before API call)
                localStorage.setItem('path_choice', path);

                // Create session in Supabase (non-blocking - session creation is best-effort)
                try {
                    const sessionId = await createUserSession(path);
                    localStorage.setItem('session_id', sessionId);
                } catch (apiError) {
                    console.warn('Could not create Supabase session:', apiError);
                    // Still continue - user can still use calculator
                }

                // Track analytics
                gtag('event', 'path_selected', {
                    'event_category': 'Calculator',
                    'event_label': path === 'free' ? 'Free Calculator' : 'Paid Protocol'
                });

                // Both paths show calculator first
                document.getElementById('pathChoice').classList.add('hidden');
                document.getElementById('calculatorForm').classList.remove('hidden');
                document.getElementById('calculatorForm').scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });

                // Update button text based on path
                if (path === 'paid') {
                    document.getElementById('calculateBtn').textContent = 'Next: Complete Your Profile';
                } else {
                    document.getElementById('calculateBtn').textContent = 'Calculate My Macros';
                }
            } catch (error) {
                console.error('Error in choosePath:', error);
                alert('Error starting calculator. Please try again.');
            }
        }

        async function createUserSession(pathChoice) {
            const response = await fetch('https://kwtdpvnjewtahuxjyltn.supabase.co/rest/v1/user_sessions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3dGRwdm5qZXd0YWh1eGp5bHRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQxNjA2NDMsImV4cCI6MTg5MTkyNzI0M30.rWArRuIUh-OGKTGLXx-5nZS8W1K03cG3X-M2RQRR-lg',
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3dGRwdm5qZXd0YWh1eGp5bHRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQxNjA2NDMsImV4cCI6MTg5MTkyNzI0M30.rWArRuIUh-OGKTGLXx-5nZS8W1K03cG3X-M2RQRR-lg'
                },
                body: JSON.stringify({
                    path_choice: pathChoice,
                    payment_status: 'unpaid'
                })
            });

            const data = await response.json();
            return data[0].id;
        }

        async function updateUserSession(sessionId, macroData) {
            await fetch(`https://kwtdpvnjewtahuxjyltn.supabase.co/rest/v1/user_sessions?id=eq.${sessionId}`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'apikey': 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3dGRwdm5qZXd0YWh1eGp5bHRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQxNjA2NDMsImV4cCI6MTg5MTkyNzI0M30.rWArRuIUh-OGKTGLXx-5nZS8W1K03cG3X-M2RQRR-lg',
                    'Authorization': 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imt3dGRwdm5qZXd0YWh1eGp5bHRuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzQxNjA2NDMsImV4cCI6MTg5MTkyNzI0M30.rWArRuIUh-OGKTGLXx-5nZS8W1K03cG3X-M2RQRR-lg'
                },
                body: JSON.stringify({
                    macro_data: macroData
                })
            });
        }

        // Show paid path continue button (skip Stripe, go straight to questionnaire)
        function showPaidPathContinueButton() {
            const continueButton = document.createElement('div');
            continueButton.style.cssText = 'margin-top: 40px; text-align: center; padding: 30px; background: linear-gradient(135deg, #ffd700 0%, #d4a574 100%); border-radius: 12px; border: 3px solid #8b4513;';
            continueButton.innerHTML = `
                <h3 style="margin: 0 0 15px 0; color: #1a120b; font-family: 'Playfair Display', serif; font-size: 1.5em;">Next: Your Complete 30-Day Protocol</h3>
                <p style="margin: 0 0 25px 0; color: #2c1810; font-size: 1em; line-height: 1.6;">
                    Answer a few quick questions about your health and preferences, and we'll generate your complete personalized protocol including meal plan, shopping lists, and doctor's script.
                </p>
                <button style="background: #1a120b; color: #ffd700; padding: 15px 40px; border: none; border-radius: 8px; font-family: 'Playfair Display', serif; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.3);"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.4)';"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.3)';"
                        onclick="goToPaidQuestionnaire()">
                    Continue to Full Report ‚Üí
                </button>
                <p style="margin: 20px 0 0 0; font-size: 0.9em; color: #2c1810; opacity: 0.8;">Takes about 5 minutes</p>
            `;
            document.getElementById('resultsSection').appendChild(continueButton);
        }

        function goToPaidQuestionnaire() {
            // Track analytics
            gtag('event', 'paid_continue_clicked', {
                'event_category': 'Paid Flow',
                'event_label': 'Continue to Questionnaire'
            });

            // Save current macro results to localStorage for questionnaire
            if (currentResults) {
                localStorage.setItem('carnivore_macros', JSON.stringify(currentResults));
            }

            // Go to paid questionnaire (paid user, already selected paid path)
            window.location.href = 'paid-questionnaire.html';
        }

        // ---------- Unit Conversion ----------
        function setUnits(units) {
            currentUnits = units;
            document.getElementById('imperialBtn').classList.toggle('active', units === 'imperial');
            document.getElementById('metricBtn').classList.toggle('active', units === 'metric');

            const imperialHeight = document.getElementById('imperialHeight');
            const heightCm = document.getElementById('heightCm');
            const weightInput = document.getElementById('weight');
            const heightUnit = document.getElementById('heightUnit');
            const weightUnit = document.getElementById('weightUnit');
            const heightHint = document.getElementById('heightHint');

            if (units === 'imperial') {
                // Show feet/inches inputs, hide cm
                imperialHeight.style.display = 'flex';
                heightCm.classList.add('hidden');
                heightUnit.textContent = '(feet & inches)';
                weightUnit.textContent = '(lbs)';
                heightHint.textContent = 'Example: 5 feet 10 inches';

                // Convert weight if switching from metric
                if (weightInput.value && weightInput.value < 100) {
                    weightInput.value = Math.round(parseFloat(weightInput.value) * 2.205);
                } else if (!weightInput.value) {
                    weightInput.value = 180;
                }
            } else {
                // Show cm input, hide feet/inches
                imperialHeight.style.display = 'none';
                heightCm.classList.remove('hidden');
                heightUnit.textContent = '(cm)';
                weightUnit.textContent = '(kg)';
                heightHint.textContent = '178 cm = 5\'10"';

                // Convert from feet/inches to cm
                const feet = parseInt(document.getElementById('heightFeet').value) || 5;
                const inches = parseInt(document.getElementById('heightInches').value) || 10;
                const totalInches = (feet * 12) + inches;
                heightCm.value = Math.round(totalInches * 2.54);

                // Convert weight if switching from imperial
                if (weightInput.value && weightInput.value > 100) {
                    weightInput.value = Math.round(parseFloat(weightInput.value) / 2.205);
                } else if (!weightInput.value) {
                    weightInput.value = 82;
                }
            }
        }

        // ---------- UI Updates ----------
        function updateActivityDisplay() {
            const lifestyle = parseFloat(document.getElementById('lifestyle').value);
            const exercise = parseFloat(document.getElementById('exercise').value);
            const total = lifestyle + exercise;
            document.getElementById('activityDisplay').textContent = total.toFixed(2) + 'x BMR';
        }

        function updateDeficitLabel() {
            const goal = document.getElementById('goal').value;
            const label = document.getElementById('deficitLabel');
            const input = document.getElementById('deficit');

            if (goal === 'lose') {
                label.textContent = 'Calorie Deficit (%)';
                input.value = 20;
            } else if (goal === 'gain') {
                label.textContent = 'Calorie Surplus (%)';
                input.value = 10;
            } else {
                label.textContent = 'Adjustment (%)';
                input.value = 0;
            }
        }

        function updateDietOptions() {
            const diet = document.getElementById('diet').value;
            const carnivoreOptions = document.getElementById('carnivoreOptions');
            const ketoOptions = document.getElementById('ketoOptions');

            if (diet === 'carnivore') {
                carnivoreOptions.classList.remove('hidden');
                ketoOptions.classList.add('hidden');
            } else {
                carnivoreOptions.classList.add('hidden');
                ketoOptions.classList.remove('hidden');

                if (diet === 'keto') {
                    document.getElementById('netCarbs').value = 20;
                } else if (diet === 'lowcarb') {
                    document.getElementById('netCarbs').value = 75;
                }
            }
        }

        // ---------- Calculations ----------
        function round(n, decimals = 0) {
            const factor = Math.pow(10, decimals);
            return Math.round(n * factor) / factor;
        }

        function clamp(n, min, max) {
            return Math.max(min, Math.min(max, n));
        }

        function getWeightKg() {
            const weight = parseFloat(document.getElementById('weight').value);
            return currentUnits === 'imperial' ? weight / 2.205 : weight;
        }

        function getHeightCm() {
            if (currentUnits === 'imperial') {
                const feet = parseInt(document.getElementById('heightFeet').value) || 0;
                const inches = parseInt(document.getElementById('heightInches').value) || 0;
                const totalInches = (feet * 12) + inches;
                return totalInches * 2.54;
            } else {
                return parseFloat(document.getElementById('heightCm').value) || 0;
            }
        }

        function calculateBMR(sex, age, heightCm, weightKg) {
            const s = sex === 'male' ? 5 : -161;
            return (10 * weightKg) + (6.25 * heightCm) - (5 * age) + s;
        }

        function calculateTDEE(bmr, activityMultiplier) {
            return bmr * activityMultiplier;
        }

        function applyGoal(tdee, goal, deficitPct) {
            const pct = clamp(deficitPct, 0, 40) / 100;
            if (goal === 'lose') return tdee * (1 - pct);
            if (goal === 'gain') return tdee * (1 + pct);
            return tdee;
        }

        function calculateMacros(calories, diet, weightKg) {
            let protein_g, fat_g, carbs_g;

            if (diet === 'carnivore') {
                const ratio = document.getElementById('ratio').value;
                const [fatPct, protPct] = ratio.split('-').map(x => parseInt(x) / 100);
                const proteinMin = parseFloat(document.getElementById('proteinMin').value);

                let protein_cal = calories * protPct;
                protein_g = protein_cal / 4;

                const minProtein = proteinMin * weightKg;
                if (protein_g < minProtein) {
                    protein_g = minProtein;
                    protein_cal = protein_g * 4;
                }

                const fat_cal = Math.max(0, calories - protein_cal);
                fat_g = fat_cal / 9;
                carbs_g = 0;

            } else {
                const netCarbs = parseFloat(document.getElementById('netCarbs').value);
                const proteinSetting = parseFloat(document.getElementById('proteinSetting').value);

                carbs_g = clamp(netCarbs, 0, 150);
                protein_g = proteinSetting * weightKg;

                const carbs_cal = carbs_g * 4;
                const protein_cal = protein_g * 4;
                const fat_cal = Math.max(0, calories - carbs_cal - protein_cal);
                fat_g = fat_cal / 9;
            }

            return { protein_g, fat_g, carbs_g };
        }

        function calculateSplit(calories, protein_g, fat_g, carbs_g) {
            const pCal = protein_g * 4;
            const fCal = fat_g * 9;
            const cCal = carbs_g * 4;
            const total = Math.max(1, calories);

            return {
                p: round((pCal / total) * 100, 0),
                f: round((fCal / total) * 100, 0),
                c: round((cCal / total) * 100, 0)
            };
        }

        function generateFlags(bmr, calories, goal, deficitPct, protein_g, weightKg) {
            const flags = [];

            const deficit = goal === 'lose' ? deficitPct : 0;
            const surplus = goal === 'gain' ? deficitPct : 0;

            if (deficit > 30) {
                flags.push({ type: 'warning', text: `${deficit}% deficit is aggressive. Consider 15-25% unless you enjoy suffering.` });
            }
            if (surplus > 20) {
                flags.push({ type: 'warning', text: `${surplus}% surplus is a fast bulk. If you hate gaining fat, try 5-15%.` });
            }
            if (goal === 'lose' && calories < bmr * 1.1) {
                flags.push({ type: 'warning', text: `Calories are under your BMR. You might feel terrible. Consider a smaller deficit.` });
            }

            const proteinMin = 1.6 * weightKg;
            if (protein_g < proteinMin) {
                flags.push({ type: 'warning', text: `Protein is under 1.6 g/kg baseline. You might lose muscle. Increase protein.` });
            }
            if (protein_g > 2.6 * weightKg) {
                flags.push({ type: 'warning', text: `Protein is very high (>2.6 g/kg). Not harmful, but you might feel better with more fat.` });
            }

            if (flags.length === 0) {
                flags.push({ type: 'success', text: `Looks good. Now go eat like the apex predator you are.` });
            }

            return flags;
        }

        // ---------- Main Calculate Function ----------
        function calculate(silent = false) {
            // Get inputs
            const sex = document.getElementById('sex').value;
            const age = clamp(parseInt(document.getElementById('age').value), 14, 99);
            const heightCm = getHeightCm();
            const weightKg = getWeightKg();
            const lifestyle = parseFloat(document.getElementById('lifestyle').value);
            const exercise = parseFloat(document.getElementById('exercise').value);
            const activity = lifestyle + exercise;
            const goal = document.getElementById('goal').value;
            const deficitPct = clamp(parseFloat(document.getElementById('deficit').value), 0, 40);
            const diet = document.getElementById('diet').value;

            // Calculate
            const bmr = calculateBMR(sex, age, heightCm, weightKg);
            const tdee = calculateTDEE(bmr, activity);
            const calories = applyGoal(tdee, goal, deficitPct);
            const { protein_g, fat_g, carbs_g } = calculateMacros(calories, diet, weightKg);
            const split = calculateSplit(calories, protein_g, fat_g, carbs_g);

            // Store results
            currentResults = {
                bmr: round(bmr, 0),
                tdee: round(tdee, 0),
                calories: round(calories, 0),
                protein_g: round(protein_g, 0),
                fat_g: round(fat_g, 0),
                carbs_g: round(carbs_g, 0),
                split,
                diet,
                goal,
                weightKg
            };

            // Display results
            document.getElementById('outCalories').textContent = currentResults.calories.toLocaleString();
            document.getElementById('outTdee').textContent = currentResults.tdee.toLocaleString();
            document.getElementById('outProtein').textContent = currentResults.protein_g.toLocaleString();
            document.getElementById('outFat').textContent = currentResults.fat_g.toLocaleString();
            document.getElementById('outCarbs').textContent = currentResults.carbs_g.toLocaleString();
            document.getElementById('outSplit').textContent = `${split.f}% / ${split.p}% / ${split.c}%`;

            // Generate flags
            const flags = generateFlags(bmr, calories, goal, deficitPct, protein_g, weightKg);
            const flagsHTML = flags.map(f => {
                const className = f.type === 'warning' ? 'warning' : 'success';
                return `<div class="${className}"><strong>${f.type === 'warning' ? '‚ö†Ô∏è' : '‚úì'}</strong> ${f.text}</div>`;
            }).join('');
            document.getElementById('flagsContainer').innerHTML = flagsHTML;

            // Generate meal examples
            generateMealExamples();

            // Show results only if not in silent mode
            if (!silent) {
                // Show results
                document.getElementById('resultsSection').classList.remove('hidden');

                // Check which path user chose
                const pathChoice = localStorage.getItem('path_choice');
                if (pathChoice === 'paid') {
                    // Hide upsell section and show "Continue to Full Report" button instead
                    document.getElementById('upgradeSection').classList.add('hidden');
                    showPaidPathContinueButton();
                } else {
                    // Free path - show upgrade section with Stripe option
                    document.getElementById('upgradeSection').classList.remove('hidden');
                }

                // Scroll to results
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }

            // Track event
            trackCalculation(diet, goal);
        }

        // ---------- Progressive Disclosure Logic ----------
        function handlePrimaryButton() {
            const pathChoice = localStorage.getItem('path_choice');

            if (pathChoice === 'paid') {
                // Paid path: Validate basic form, then reveal advanced sections
                if (!validateBasicForm()) {
                    alert('Please fill out all required fields');
                    return;
                }

                // Calculate macros silently (store in currentResults)
                calculate(true);

                // Reveal advanced sections
                revealAdvancedSections();
            } else {
                // Free path: Calculate and show results normally
                calculate();
            }
        }

        function validateBasicForm() {
            const age = document.getElementById('age').value;
            const weight = document.getElementById('weight').value;
            const height = document.getElementById('heightFeet').value || document.getElementById('heightCm').value;

            return age && weight && height;
        }

        function revealAdvancedSections() {
            // Hide the primary button
            document.getElementById('calculateBtn').style.display = 'none';

            // Show advanced sections with smooth reveal
            const advancedSections = document.getElementById('advancedSections');
            advancedSections.classList.remove('hidden');

            // Show submit button
            document.getElementById('advancedSubmitSection').classList.remove('hidden');

            // Smooth scroll to advanced sections
            advancedSections.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Track analytics
            gtag('event', 'advanced_sections_revealed', {
                'event_category': 'Paid Path',
                'event_label': 'Progressive Disclosure'
            });
        }

        async function submitAdvancedForm() {
            // Validate email is required
            const email = document.getElementById('email').value;
            if (!email) {
                alert('Please enter your email address to receive your protocol');
                document.getElementById('email').focus();
                return;
            }

            // Hide form and show progress bar
            document.getElementById('advancedSections').style.display = 'none';

            // Create progress bar UI
            const progressHTML = `
                <div style="background: linear-gradient(135deg, #faf8f3 0%, #f5f2ed 100%); border: 3px solid #8b4513; border-radius: 12px; padding: 40px; text-align: center;">
                    <h2 style="color: #8b4513; font-family: 'Playfair Display', serif; margin: 0 0 10px 0; font-size: 1.8em;">Building Your Protocol...</h2>
                    <p style="color: #666; margin: 0 0 35px 0; font-size: 1.05em;">This is going to be amazing!</p>

                    <div style="max-width: 500px; margin: 0 auto; text-align: left;">
                        <div id="progressItem1" style="display: flex; align-items: center; margin-bottom: 20px; opacity: 0.5; transition: all 0.3s;">
                            <div style="width: 40px; height: 40px; background: #d4a574; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">
                                <span style="font-size: 1.3em;">‚öôÔ∏è</span>
                            </div>
                            <span style="font-family: 'Merriweather', serif; font-size: 1.05em; color: #2c1810;">Calculating your personalized macros</span>
                        </div>

                        <div id="progressItem2" style="display: flex; align-items: center; margin-bottom: 20px; opacity: 0.3; transition: all 0.3s;">
                            <div style="width: 40px; height: 40px; background: #d4a574; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">
                                <span style="font-size: 1.3em;">üçΩÔ∏è</span>
                            </div>
                            <span style="font-family: 'Merriweather', serif; font-size: 1.05em; color: #2c1810;">Generating meal plans</span>
                        </div>

                        <div id="progressItem3" style="display: flex; align-items: center; margin-bottom: 20px; opacity: 0.3; transition: all 0.3s;">
                            <div style="width: 40px; height: 40px; background: #d4a574; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">
                                <span style="font-size: 1.3em;">üõí</span>
                            </div>
                            <span style="font-family: 'Merriweather', serif; font-size: 1.05em; color: #2c1810;">Creating shopping lists</span>
                        </div>

                        <div id="progressItem4" style="display: flex; align-items: center; margin-bottom: 20px; opacity: 0.3; transition: all 0.3s;">
                            <div style="width: 40px; height: 40px; background: #d4a574; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">
                                <span style="font-size: 1.3em;">üìã</span>
                            </div>
                            <span style="font-family: 'Merriweather', serif; font-size: 1.05em; color: #2c1810;">Preparing doctor's consultation script</span>
                        </div>

                        <div id="progressItem5" style="display: flex; align-items: center; margin-bottom: 20px; opacity: 0.3; transition: all 0.3s;">
                            <div style="width: 40px; height: 40px; background: #d4a574; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; flex-shrink: 0;">
                                <span style="font-size: 1.3em;">üìÑ</span>
                            </div>
                            <span style="font-family: 'Merriweather', serif; font-size: 1.05em; color: #2c1810;">Compiling your complete protocol</span>
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('advancedSubmitSection').innerHTML = progressHTML;

            try {
                // Collect basic calculator data
                const basicData = {
                    sex: document.getElementById('sex').value,
                    age: document.getElementById('age').value,
                    weight: document.getElementById('weight').value,
                    heightFeet: document.getElementById('heightFeet').value,
                    heightInches: document.getElementById('heightInches').value,
                    heightCm: document.getElementById('heightCm').value,
                    lifestyle: document.getElementById('lifestyle').value,
                    exercise: document.getElementById('exercise').value,
                    goal: document.getElementById('goal').value,
                    deficit: document.getElementById('deficit').value,
                    diet: document.getElementById('diet').value,
                    ratio: document.getElementById('ratio')?.value,
                    proteinMin: document.getElementById('proteinMin')?.value,
                    netCarbs: document.getElementById('netCarbs')?.value,
                    proteinSetting: document.getElementById('proteinSetting')?.value
                };

                // Collect advanced form data
                const advancedData = {
                    email: email,
                    firstName: document.querySelector('input[name="firstName"]')?.value,
                    medications: document.querySelector('textarea[name="medications"]')?.value,
                    conditions: Array.from(document.querySelectorAll('input[name="conditions"]:checked')).map(cb => cb.value),
                    allergies: document.querySelector('textarea[name="allergies"]')?.value,
                    avoidFoods: document.querySelector('textarea[name="avoidFoods"]')?.value,
                    previousDiets: document.querySelector('textarea[name="previousDiets"]')?.value,
                    carnivoreExperience: document.querySelector('select[name="carnivoreExperience"]')?.value,
                    selectedProtocol: document.querySelector('select[name="selectedProtocol"]')?.value,
                    goals: Array.from(document.querySelectorAll('input[name="goals"]:checked')).map(cb => cb.value),
                    additionalNotes: document.querySelector('textarea[name="additionalNotes"]')?.value
                };

                // Combine basic + advanced data
                const completeData = {
                    ...basicData,
                    ...advancedData,
                    macros: currentResults,
                    session_id: localStorage.getItem('session_id'),
                    path_choice: 'paid'
                };

                // Simulate progress with setTimeout for excitement
                const progressSteps = [
                    { item: 1, delay: 500 },
                    { item: 2, delay: 1500 },
                    { item: 3, delay: 2500 },
                    { item: 4, delay: 3500 },
                    { item: 5, delay: 4500 }
                ];

                // Update progress items
                progressSteps.forEach(({ item, delay }) => {
                    setTimeout(() => {
                        const elem = document.getElementById(`progressItem${item}`);
                        if (elem) {
                            elem.style.opacity = '1';
                            // Update icon to checkmark
                            const icon = elem.querySelector('span');
                            if (icon) {
                                icon.textContent = '‚úÖ';
                                icon.style.color = '#4caf50';
                            }
                        }
                    }, delay);
                });

                // Send to Worker after small delay
                setTimeout(async () => {
                    try {
                        const response = await fetch('https://carnivore-report-api-production.iambrew.workers.dev/', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(completeData)
                        });

                        const result = await response.json();

                        if (result.success) {
                            // Show success message
                            document.getElementById('advancedSubmitSection').innerHTML = `
                                <div style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border: 3px solid #4caf50; border-radius: 12px; padding: 40px; text-align: center;">
                                    <h2 style="color: #2e7d32; font-family: 'Playfair Display', serif; margin: 0 0 10px 0; font-size: 1.8em;">‚úÖ Protocol Complete!</h2>
                                    <p style="color: #558b2f; margin: 0 0 20px 0; font-size: 1.1em; font-weight: bold;">Your personalized 30-day carnivore protocol is ready</p>

                                    <div style="background: white; border-radius: 8px; padding: 25px; margin-bottom: 20px;">
                                        <p style="margin: 0 0 10px 0; color: #2c1810; font-size: 1em;">üìß <strong>Check your email at:</strong></p>
                                        <p style="margin: 0 0 15px 0; color: #8b4513; font-size: 1.1em; font-weight: bold;">${email}</p>
                                        <p style="margin: 0; color: #666; font-size: 0.95em;">Your access link expires in 48 hours. Download your complete protocol for permanent access.</p>
                                    </div>

                                    <p style="color: #558b2f; margin: 0; font-size: 0.95em;">Your protocol includes: macros ‚Ä¢ meal plans ‚Ä¢ shopping lists ‚Ä¢ doctor's script ‚Ä¢ complete personalization</p>
                                </div>
                            `;

                            // Track conversion
                            gtag('event', 'purchase', {
                                'event_category': 'Paid Report',
                                'value': 9.99
                            });
                        } else {
                            throw new Error(result.error || 'Failed to generate protocol');
                        }
                    } catch (error) {
                        console.error('Worker error:', error);
                        document.getElementById('advancedSubmitSection').innerHTML = `
                            <div style="background: #ffebee; border: 3px solid #c62828; border-radius: 12px; padding: 30px; text-align: center;">
                                <h2 style="color: #c62828; margin: 0 0 10px 0;">‚ö†Ô∏è Processing Error</h2>
                                <p style="color: #2c1810; margin: 0 0 15px 0;">There was an issue generating your protocol.</p>
                                <p style="color: #666; font-size: 0.95em; margin: 0;">Error: ${error.message}</p>
                                <p style="color: #666; font-size: 0.9em; margin-top: 15px;">Please try again or contact support.</p>
                            </div>
                        `;
                    }
                }, 5500);

            } catch (error) {
                console.error('Submission error:', error);
                document.getElementById('advancedSubmitSection').innerHTML = `
                    <div style="background: #ffebee; border: 3px solid #c62828; border-radius: 12px; padding: 30px; text-align: center;">
                        <h2 style="color: #c62828; margin: 0 0 10px 0;">‚ùå Error</h2>
                        <p style="color: #2c1810; margin: 0 0 10px 0;">Could not submit your form.</p>
                        <p style="color: #666; font-size: 0.95em; margin: 0;">Error: ${error.message}</p>
                    </div>
                `;
            }
        }

        function upgradeFromFree() {
            // Change path to paid
            localStorage.setItem('path_choice', 'paid');

            // Hide results and upgrade section
            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('upgradeSection').classList.add('hidden');

            // Scroll back to top of calculator
            document.getElementById('calculatorForm').scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Reveal advanced sections after scroll
            setTimeout(() => {
                revealAdvancedSections();
            }, 500);

            // Track analytics
            gtag('event', 'upgrade_clicked', {
                'event_category': 'Conversion',
                'event_label': 'Free to Paid'
            });
        }

        // ---------- Meal Examples Generation ----------
        function generateMealExamples() {
            if (!currentResults) return;

            const { calories, protein_g, fat_g, diet } = currentResults;

            let html = '';

            if (diet === 'carnivore') {
                // Calculate portion sizes
                const caloriesPerMeal = Math.round(calories / 2);
                const proteinPerMeal = Math.round(protein_g / 2);

                // Different meat types and their protein per oz
                // Ribeye: 6g protein/oz, NY Strip: 6g/oz, Ground beef 80/20: 5.5g/oz, Salmon: 6g/oz
                const ribeye_oz = Math.round(proteinPerMeal / 6);
                const groundBeef_oz = Math.round(proteinPerMeal / 5.5);
                const salmon_oz = Math.round(proteinPerMeal / 6);
                const bacon_oz = Math.round((protein_g / 3) / 5);

                html = `
                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-top: 0; color: #8b4513; font-size: 1.3em;">ü•© Option 1: Two Large Meals (Most Popular)</h4>
                        <div style="background: #faf8f3; border-left: 4px solid #8b4513; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="margin: 0 0 15px 0; font-weight: bold; color: #2c1810;">Meal 1 (${caloriesPerMeal} calories) - Breakfast or Lunch</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li><strong>${ribeye_oz}oz Ribeye Steak</strong> (about the size of your palm, 2-3 fingers thick) - seared in butter until medium-rare</li>
                                <li><strong>3-4 Large Eggs</strong> - fried, scrambled, or poached in butter (adds 150-200 calories)</li>
                                <li><strong>Salt & Pepper</strong> - generous pinch on meat and eggs</li>
                            </ul>
                            <p style="margin: 15px 0 0 0; font-size: 0.95em; color: #666; font-style: italic;">What it looks like: A palm-sized steak next to a pile of golden eggs. Total plate size: standard dinner plate.</p>
                        </div>

                        <div style="background: #faf8f3; border-left: 4px solid #8b4513; padding: 20px; border-radius: 8px;">
                            <p style="margin: 0 0 15px 0; font-weight: bold; color: #2c1810;">Meal 2 (${caloriesPerMeal} calories) - Lunch or Dinner</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li><strong>${groundBeef_oz}oz Ground Beef (80/20)</strong> - makes 2-3 large burger patties (no bun), juicy from the fat</li>
                                <li><strong>2-3oz Cheddar or Brie Cheese</strong> - melted on the burger patty</li>
                                <li><strong>Sea Salt & Butter</strong> - to finish</li>
                            </ul>
                            <p style="margin: 15px 0 0 0; font-size: 0.95em; color: #666; font-style: italic;">What it looks like: 2-3 thick, juicy burger patties stacked with melted cheese. Very satisfying and easy to prepare.</p>
                        </div>

                        <p style="margin-top: 20px; padding: 15px; background: #ffd700; border-radius: 8px; color: #2c1810;">
                            <strong>üí° Why this works:</strong> Two big meals = never hungry between meals. You're eating until satisfied, not counting calories. The fat keeps you full for 6-8 hours.
                        </p>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-top: 0; color: #8b4513; font-size: 1.3em;">üçó Option 2: Three Regular Meals (More Structure)</h4>
                        <div style="background: #faf8f3; border-left: 4px solid #8b4513; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="margin: 0 0 15px 0; font-weight: bold; color: #2c1810;">Breakfast (${Math.round(calories / 3)} calories)</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li><strong>5-6 Large Eggs</strong> - any style (scrambled in butter is easiest)</li>
                                <li><strong>${bacon_oz}oz Bacon</strong> - about 6-8 strips, crispy</li>
                            </ul>
                            <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #666;">The ultimate breakfast: fluffy eggs + crispy bacon. Carb-free energy that lasts all morning.</p>
                        </div>

                        <div style="background: #faf8f3; border-left: 4px solid #8b4513; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <p style="margin: 0 0 15px 0; font-weight: bold; color: #2c1810;">Lunch (${Math.round(calories / 3)} calories)</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li><strong>${Math.round(groundBeef_oz * 0.8)}oz Beef Burger Patties</strong> - with melted cheese, or as a burger bowl</li>
                                <li><strong>Extra Butter or Fatty Sauce</strong> - to add calories and flavor</li>
                            </ul>
                            <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #666;">Easy lunch you can meal prep. Cook 10 patties on Sunday, heat 2-3 patties + cheese for lunch.</p>
                        </div>

                        <div style="background: #faf8f3; border-left: 4px solid #8b4513; padding: 20px; border-radius: 8px;">
                            <p style="margin: 0 0 15px 0; font-weight: bold; color: #2c1810;">Dinner (${Math.round(calories / 3)} calories)</p>
                            <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                                <li><strong>${salmon_oz}oz Salmon or Prime Rib</strong> - cooked in butter or your favorite method</li>
                                <li><strong>Lemon & Sea Salt</strong> - or garlic butter</li>
                                <li><strong>Optional: Organ Meat</strong> - beef liver (small 2-3oz portion for nutrition)</li>
                            </ul>
                            <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #666;">Variety keeps it interesting. Salmon for omega-3s, liver once per week for micronutrients.</p>
                        </div>
                    </div>

                    <div style="margin-bottom: 30px;">
                        <h4 style="margin-top: 0; color: #8b4513; font-size: 1.3em;">‚ö†Ô∏è Common Mistakes to Avoid</h4>
                        <ul style="margin: 0; padding-left: 20px;">
                            <li><strong>Using too-lean meat:</strong> Choose 80/20 ground beef, ribeye, or salmon. Avoid sirloin or lean cuts. Fat = energy and satiety.</li>
                            <li><strong>Not eating enough eggs:</strong> Eggs are cheap, convenient, and complete nutrition. Aim for 2-4 per meal.</li>
                            <li><strong>Forgetting salt:</strong> Carnivore requires MORE salt than normal diets. Add it generously.</li>
                            <li><strong>Skipping butter/fat:</strong> Cook in butter, add butter to meals. This is a high-fat diet.</li>
                        </ul>
                    </div>
                `;
            } else {
                // Keto examples
                html = `
                    <div style="background: #faf8f3; border-left: 4px solid #8b4513; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="margin-top: 0; color: #8b4513;">ü•ó Keto Day Example</h4>
                        <p><strong>Breakfast:</strong> 3-4 eggs (any style) + 1/2 avocado + butter</p>
                        <p><strong>Lunch:</strong> ${Math.round(protein_g / 3)}g chicken thighs + mixed greens + olive oil dressing</p>
                        <p><strong>Dinner:</strong> ${Math.round(protein_g / 3)}g salmon or beef + roasted broccoli cooked in butter</p>
                        <p><strong>Snack (optional):</strong> Cheese, macadamia nuts, or pork rinds</p>
                        <p style="font-size: 0.9em; color: #666;"><strong>Key difference:</strong> Keto includes some low-carb vegetables. Use the carbs on veggies (fiber doesn't count), not grains.</p>
                    </div>
                `;
            }

            document.getElementById('mealExamplesContent').innerHTML = html;
        }

        // ---------- Helper Functions ----------
        function resetForm() {
            if (currentUnits === 'imperial') {
                document.getElementById('heightFeet').value = 5;
                document.getElementById('heightInches').value = 10;
                document.getElementById('weight').value = 180;
            } else {
                document.getElementById('heightCm').value = 178;
                document.getElementById('weight').value = 82;
            }
            document.getElementById('age').value = 35;
            document.getElementById('sex').value = 'male';
            document.getElementById('lifestyle').value = '1.2';
            document.getElementById('exercise').value = '0.3';
            document.getElementById('goal').value = 'lose';
            document.getElementById('deficit').value = 0;
            document.getElementById('diet').value = 'carnivore';
            document.getElementById('ratio').value = '70-30';
            document.getElementById('proteinMin').value = '1.6';

            updateDietOptions();
            updateDeficitLabel();
            updateActivityDisplay();

            document.getElementById('resultsSection').classList.add('hidden');
            document.getElementById('upgradeSection').classList.add('hidden');
        }

        function scrollToUpgrade() {
            document.getElementById('upgradeSection').scrollIntoView({ behavior: 'smooth' });
        }

        function upgradeClick() {
            trackUpgradeClick();

            // Save current macro results to localStorage for questionnaire
            if (currentResults) {
                localStorage.setItem('carnivore_macros', JSON.stringify(currentResults));
            }

            // Redirect to Stripe checkout
            window.location.href = 'https://buy.stripe.com/dRm3cv7OHalA8FM092ao801';
        }

        // ---------- Payment Success Handling ----------
        function checkPaymentStatus() {
            const urlParams = new URLSearchParams(window.location.search);

            if (urlParams.get('success') === 'true') {
                // Redirect to paid questionnaire page
                window.location.href = 'paid-questionnaire.html';
            }

            if (urlParams.get('cancelled') === 'true') {
                // Show cancelled message
                const cancelMsg = document.createElement('div');
                cancelMsg.innerHTML = `
                    <div style="
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: rgba(139, 69, 19, 0.95);
                        color: #f4e4d4;
                        padding: 20px 30px;
                        border-radius: 10px;
                        border: 2px solid #d4a574;
                        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                        z-index: 10000;
                        max-width: 350px;
                    ">
                        <p style="margin: 0; font-size: 1em;">
                            Payment cancelled. No worries! The free calculator is still here whenever you need it.
                        </p>
                        <button onclick="this.parentElement.remove(); window.history.replaceState({}, '', '/calculator.html');" style="
                            margin-top: 15px;
                            background: #d4a574;
                            color: #1a120b;
                            border: none;
                            padding: 8px 20px;
                            border-radius: 6px;
                            cursor: pointer;
                            font-weight: bold;
                        ">Close</button>
                    </div>
                `;
                document.body.appendChild(cancelMsg);

                // Auto-dismiss after 5 seconds
                setTimeout(() => {
                    if (cancelMsg.parentElement) {
                        cancelMsg.remove();
                        window.history.replaceState({}, '', '/calculator.html');
                    }
                }, 5000);
            }
        }

        // ---------- Init ----------
        updateDietOptions();
        updateDeficitLabel();
        updateActivityDisplay();
        checkPaymentStatus();
    </script>
</body>
</html>
