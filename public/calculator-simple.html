<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carnivore Calculator - Personalized Macro Report</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Merriweather', serif; color: #2c1810; background: #f4e4d4; line-height: 1.6; }

        .container { max-width: 900px; margin: 0 auto; padding: 40px 20px; }

        header { text-align: center; margin-bottom: 40px; }
        header h1 { font-family: 'Playfair Display', serif; font-size: 2.5em; color: #b8860b; margin-bottom: 10px; }
        header p { color: #666; font-size: 1.1em; }

        .form-section { background: white; padding: 30px; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 700; color: #b8860b; margin-bottom: 8px; font-size: 0.95em; }
        input, select, textarea { width: 100%; padding: 10px; border: 2px solid #d4a574; border-radius: 4px; font-family: inherit; font-size: 1em; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #b8860b; background: #fffbf5; }

        .radio-group { display: flex; gap: 20px; }
        .radio-group label { margin-bottom: 0; font-weight: 400; }

        .row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        button {
            background: #b8860b; color: white; padding: 14px 32px; border: none; border-radius: 6px;
            font-size: 1em; font-weight: 700; cursor: pointer; width: 100%;
            transition: background 0.3s; font-family: inherit;
        }
        button:hover { background: #9a7109; }
        button:disabled { background: #ccc; cursor: not-allowed; }

        .progress { margin: 20px 0; }
        .progress-bar { background: #e0d5c7; height: 30px; border-radius: 4px; overflow: hidden; }
        .progress-fill { background: #b8860b; height: 100%; width: 0%; transition: width 0.3s; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; }

        .report { background: white; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .report h2 { font-family: 'Playfair Display', serif; color: #b8860b; font-size: 2em; margin-bottom: 20px; }
        .report-section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #e0d5c7; }
        .report-section:last-child { border-bottom: none; }
        .report-section h3 { color: #b8860b; margin-bottom: 10px; }

        .macro-box { background: #f9f5f0; padding: 15px; border-left: 4px solid #d4a574; margin: 10px 0; }
        .macro-row { display: flex; justify-content: space-between; padding: 8px 0; }

        .hidden { display: none; }
        .error { color: #d32f2f; padding: 15px; background: #ffebee; border-radius: 4px; margin: 15px 0; }
        .success { color: #388e3c; padding: 15px; background: #e8f5e9; border-radius: 4px; margin: 15px 0; }

        .actions { display: flex; gap: 15px; margin-top: 20px; }
        .btn-secondary { background: #d4a574; padding: 10px 20px; font-size: 0.9em; }
    </style>
</head>
<body>

<div class="container">

    <header>
        <h1>Carnivore Calculator</h1>
        <p>Get Your Personalized Macro Report in Seconds</p>
    </header>

    <!-- FORM -->
    <div id="form-section" class="form-section">
        <h2 style="color: #b8860b; margin-bottom: 25px;">Your Profile</h2>

        <div class="form-group">
            <label>Sex</label>
            <div class="radio-group">
                <label><input type="radio" name="sex" value="male"> Male</label>
                <label><input type="radio" name="sex" value="female"> Female</label>
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <label>Age</label>
                <input type="number" name="age" min="18" max="120">
            </div>
            <div class="form-group">
                <label>Weight (lbs)</label>
                <input type="number" name="weight" min="80" max="400">
            </div>
        </div>

        <div class="row">
            <div class="form-group">
                <label>Height (inches)</label>
                <input type="number" name="height" min="48" max="96">
            </div>
            <div class="form-group">
                <label>Activity Level</label>
                <select name="activity">
                    <option value="">Select...</option>
                    <option value="sedentary">Sedentary</option>
                    <option value="light">Light Activity</option>
                    <option value="moderate">Moderate Activity</option>
                    <option value="active">Very Active</option>
                </select>
            </div>
        </div>

        <div class="form-group">
            <label>Goal</label>
            <select name="goal">
                <option value="">Select...</option>
                <option value="fat_loss">Fat Loss</option>
                <option value="maintain">Maintain Weight</option>
                <option value="muscle_gain">Muscle Gain</option>
            </select>
        </div>

        <div class="form-group">
            <label>Email (to save your report)</label>
            <input type="email" name="email" required>
        </div>

        <button onclick="generateReport()">Generate My Personalized Report</button>
    </div>

    <!-- PROGRESS -->
    <div id="progress-section" class="hidden">
        <div class="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill">0%</div>
            </div>
        </div>
        <p style="text-align: center; color: #666;" id="progress-text">Generating your report...</p>
    </div>

    <!-- REPORT -->
    <div id="report-section" class="hidden">
        <div class="report" id="report-content"></div>
        <div class="actions">
            <button class="btn-secondary" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
            <button class="btn-secondary" onclick="location.reload()">üîÑ New Calculation</button>
        </div>
    </div>

</div>

<script>
async function generateReport() {
    const formData = {
        sex: document.querySelector('input[name="sex"]:checked')?.value,
        age: parseInt(document.querySelector('input[name="age"]').value),
        weight: parseInt(document.querySelector('input[name="weight"]').value),
        height: parseInt(document.querySelector('input[name="height"]').value),
        activity: document.querySelector('select[name="activity"]').value,
        goal: document.querySelector('select[name="goal"]').value,
        email: document.querySelector('input[name="email"]').value,
    };

    // Validate
    if (!formData.sex || !formData.age || !formData.weight || !formData.height || !formData.activity || !formData.goal || !formData.email) {
        alert('Please fill in all fields');
        return;
    }

    // Show progress
    document.getElementById('form-section').classList.add('hidden');
    document.getElementById('progress-section').classList.remove('hidden');

    try {
        // Call Claude API directly
        const response = await fetch('/api/generate-report', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
        });

        if (!response.ok) {
            throw new Error('Failed to generate report');
        }

        const data = await response.json();
        displayReport(data.report, formData);

    } catch (err) {
        document.getElementById('progress-section').classList.add('hidden');
        document.getElementById('form-section').classList.remove('hidden');
        alert('Error: ' + err.message);
    }
}

function displayReport(reportContent, formData) {
    const html = `
        <h2>Your Personalized Carnivore Report</h2>

        <div class="report-section">
            <h3>Profile Summary</h3>
            <p><strong>${formData.sex === 'male' ? 'Male' : 'Female'}</strong> ‚Ä¢ <strong>${formData.age}</strong> years old ‚Ä¢ <strong>${formData.height}"</strong> tall ‚Ä¢ <strong>${formData.weight} lbs</strong></p>
            <p>Activity: <strong>${formData.activity}</strong> ‚Ä¢ Goal: <strong>${formData.goal.replace('_', ' ')}</strong></p>
        </div>

        <div class="report-section">
            <h3>Personalized Protocol</h3>
            ${reportContent}
        </div>

        <div class="report-section">
            <p style="color: #999; font-size: 0.9em;">Report generated for ${formData.email}</p>
        </div>
    `;

    document.getElementById('report-content').innerHTML = html;
    document.getElementById('progress-section').classList.add('hidden');
    document.getElementById('report-section').classList.remove('hidden');
}
</script>

</body>
</html>
