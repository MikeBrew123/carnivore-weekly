/**
 * Wiki Auto-Linker Styles
 *
 * Styles for automatically linked wiki keywords with hover preview popups.
 * Includes desktop hover, mobile tap, and keyboard navigation support.
 * WCAG 2.1 AA accessible with proper focus indicators and semantic HTML.
 */

/* ====================================================================
   Wiki Link Styles
   ==================================================================== */

a.wiki-link {
    /* Visual distinction from regular links */
    color: #8b4513;
    border-bottom: 2px dotted #d4a574;
    text-decoration: none;
    cursor: help;
    position: relative;
    transition: all 0.2s ease-in-out;

    /* Ensure link is keyboard accessible */
    outline-offset: 2px;
}

a.wiki-link:hover,
a.wiki-link:focus {
    /* Enhanced visual feedback */
    border-bottom-style: solid;
    border-bottom-color: #8b4513;
    background-color: rgba(212, 165, 116, 0.1);
    color: #654321;
}

/* Active/pressed state for mobile */
a.wiki-link:active {
    background-color: rgba(212, 165, 116, 0.2);
}

/* Focus visible for keyboard navigation (WCAG AA) */
a.wiki-link:focus-visible {
    outline: 2px solid #ffd700;
    outline-offset: 2px;
    border-radius: 2px;
}

/* Prevent link styling when inside already-linked text */
a.wiki-link:visited {
    color: #8b4513;
}

/* ====================================================================
   Wiki Preview Popup
   ==================================================================== */

.wiki-preview {
    /* Hidden by default, shown on hover/focus/click */
    display: none;
    position: absolute;
    z-index: 1000;

    /* Positioning */
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 10px;

    /* Styling */
    background: white;
    border: 2px solid #8b4513;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    padding: 12px 16px;
    max-width: 300px;
    min-width: 200px;

    /* Typography */
    font-size: 14px;
    line-height: 1.4;
    color: #333;
    font-family: 'Merriweather', serif;

    /* Animation */
    animation: wiki-preview-fade-in 0.2s ease-in-out;

    /* Prevent text selection when previewing */
    user-select: none;
    pointer-events: auto;
}

/* Arrow/pointer on preview popup */
.wiki-preview::before {
    content: '';
    position: absolute;
    bottom: -8px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid #8b4513;
}

.wiki-preview::after {
    content: '';
    position: absolute;
    bottom: -6px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    border-top: 7px solid white;
}

/* Show preview on hover/focus */
a.wiki-link:hover > .wiki-preview,
a.wiki-link:focus > .wiki-preview,
.wiki-link.preview-active > .wiki-preview {
    display: block;
}

/* ====================================================================
   Preview Content Styling
   ==================================================================== */

.wiki-preview-title {
    font-family: 'Playfair Display', serif;
    font-size: 16px;
    font-weight: 700;
    color: #8b4513;
    margin-bottom: 8px;
    word-break: break-word;
}

.wiki-preview-summary {
    color: #555;
    margin-bottom: 10px;
    line-height: 1.5;
}

.wiki-preview-link {
    display: inline-block;
    color: #8b4513;
    text-decoration: none;
    font-weight: 600;
    border-bottom: 1px solid #d4a574;
    transition: all 0.2s ease-in-out;
}

.wiki-preview-link:hover {
    border-bottom-color: #8b4513;
    color: #654321;
}

.wiki-preview-link:focus-visible {
    outline: 2px solid #ffd700;
    outline-offset: 2px;
}

/* ====================================================================
   Loading State
   ==================================================================== */

.wiki-link.loading > .wiki-preview {
    display: block;
}

.wiki-preview.loading {
    min-height: 40px;
}

.wiki-preview.loading::after {
    content: 'Loading...';
    display: block;
    color: #999;
    font-style: italic;
}

/* ====================================================================
   Animation Keyframes
   ==================================================================== */

@keyframes wiki-preview-fade-in {
    from {
        opacity: 0;
        transform: translateX(-50%) translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
    }
}

/* ====================================================================
   Mobile Responsive Styles
   ==================================================================== */

/* On mobile, use click instead of hover */
@media (max-width: 768px) {
    a.wiki-link {
        border-bottom-width: 1px;
    }

    /* Hide preview on hover for mobile */
    a.wiki-link:hover > .wiki-preview {
        display: none;
    }

    /* Show preview only on active/clicked state */
    .wiki-link.preview-active > .wiki-preview {
        display: block;
    }

    /* Adjust preview positioning for mobile */
    .wiki-preview {
        /* Try to show above, but fallback below if too close to top */
        bottom: 100%;
        margin-bottom: 8px;
        max-width: calc(100vw - 20px);
        max-height: 40vh;
        overflow-y: auto;
    }

    /* If near top of viewport, show below instead */
    .wiki-preview.below {
        bottom: auto;
        top: 100%;
        margin-bottom: 0;
        margin-top: 8px;
    }

    .wiki-preview.below::before {
        bottom: auto;
        top: -8px;
        border-left: 8px solid transparent;
        border-right: 8px solid transparent;
        border-top: none;
        border-bottom: 8px solid #8b4513;
    }

    .wiki-preview.below::after {
        bottom: auto;
        top: -6px;
        border-left: 7px solid transparent;
        border-right: 7px solid transparent;
        border-top: none;
        border-bottom: 7px solid white;
    }
}

/* ====================================================================
   Accessibility: Reduced Motion
   ==================================================================== */

@media (prefers-reduced-motion: reduce) {
    a.wiki-link {
        transition: none;
    }

    .wiki-preview {
        animation: none;
    }
}

/* ====================================================================
   Dark Mode Support
   ==================================================================== */

@media (prefers-color-scheme: dark) {
    a.wiki-link {
        color: #e8c5a0;
        border-bottom-color: #d4a574;
    }

    a.wiki-link:hover,
    a.wiki-link:focus {
        border-bottom-color: #e8c5a0;
        background-color: rgba(212, 165, 116, 0.2);
        color: #f5ddb0;
    }

    a.wiki-link:visited {
        color: #e8c5a0;
    }

    .wiki-preview {
        background: #2a2a2a;
        border-color: #d4a574;
        color: #e8e8e8;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    }

    .wiki-preview::before {
        border-top-color: #d4a574;
    }

    .wiki-preview::after {
        border-top-color: #2a2a2a;
    }

    .wiki-preview-title {
        color: #e8c5a0;
    }

    .wiki-preview-summary {
        color: #ccc;
    }

    .wiki-preview-link {
        color: #e8c5a0;
        border-bottom-color: #d4a574;
    }

    .wiki-preview-link:hover {
        border-bottom-color: #e8c5a0;
        color: #f5ddb0;
    }
}

/* ====================================================================
   Print Styles
   ==================================================================== */

@media print {
    a.wiki-link {
        border-bottom: 1px solid #8b4513;
    }

    /* Don't show preview in print */
    .wiki-preview {
        display: none !important;
    }

    /* Show full URL in print */
    a.wiki-link::after {
        content: ' (' attr(href) ')';
        font-size: 0.8em;
        color: #666;
    }
}

/* ====================================================================
   High Contrast Mode (WCAG AAA)
   ==================================================================== */

@media (prefers-contrast: more) {
    a.wiki-link {
        border-bottom-width: 3px;
        font-weight: 600;
    }

    a.wiki-link:focus-visible {
        outline-width: 3px;
    }

    .wiki-preview {
        border-width: 3px;
    }

    .wiki-preview-title {
        font-weight: 900;
    }
}
